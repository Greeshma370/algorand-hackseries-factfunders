const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./secp256k1-Cez8NuvW.js","./index-BvQbX75z.js","./index-CAXjnnpC.css","./format-CIF1Y4UC.js"])))=>i.map(i=>d[i]);
import{g as Mc,_ as yh}from"./index-BvQbX75z.js";import{r as Zi,f as Kt,g as Vt,c as wh,a as Ln,p as mh,b as Bn,d as St}from"./format-CIF1Y4UC.js";var Un={exports:{}},wr=typeof Reflect=="object"?Reflect:null,wo=wr&&typeof wr.apply=="function"?wr.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},Ni;wr&&typeof wr.ownKeys=="function"?Ni=wr.ownKeys:Object.getOwnPropertySymbols?Ni=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ni=function(e){return Object.getOwnPropertyNames(e)};function bh(t){console&&console.warn&&console.warn(t)}var jc=Number.isNaN||function(e){return e!==e};function ee(){ee.init.call(this)}Un.exports=ee;Un.exports.once=Ih;ee.EventEmitter=ee;ee.prototype._events=void 0;ee.prototype._eventsCount=0;ee.prototype._maxListeners=void 0;var mo=10;function Xi(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(ee,"defaultMaxListeners",{enumerable:!0,get:function(){return mo},set:function(t){if(typeof t!="number"||t<0||jc(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");mo=t}});ee.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ee.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||jc(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function qc(t){return t._maxListeners===void 0?ee.defaultMaxListeners:t._maxListeners}ee.prototype.getMaxListeners=function(){return qc(this)};ee.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var s=e==="error",n=this._events;if(n!==void 0)s=s&&n.error===void 0;else if(!s)return!1;if(s){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=n[e];if(c===void 0)return!1;if(typeof c=="function")wo(c,this,r);else for(var l=c.length,u=Hc(c,l),i=0;i<l;++i)wo(u[i],this,r);return!0};function zc(t,e,r,i){var s,n,o;if(Xi(r),n=t._events,n===void 0?(n=t._events=Object.create(null),t._eventsCount=0):(n.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),n=t._events),o=n[e]),o===void 0)o=n[e]=r,++t._eventsCount;else if(typeof o=="function"?o=n[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),s=qc(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,bh(a)}return t}ee.prototype.addListener=function(e,r){return zc(this,e,r,!1)};ee.prototype.on=ee.prototype.addListener;ee.prototype.prependListener=function(e,r){return zc(this,e,r,!0)};function vh(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Fc(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},s=vh.bind(i);return s.listener=r,i.wrapFn=s,s}ee.prototype.once=function(e,r){return Xi(r),this.on(e,Fc(this,e,r)),this};ee.prototype.prependOnceListener=function(e,r){return Xi(r),this.prependListener(e,Fc(this,e,r)),this};ee.prototype.removeListener=function(e,r){var i,s,n,o,a;if(Xi(r),s=this._events,s===void 0)return this;if(i=s[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(n=-1,o=i.length-1;o>=0;o--)if(i[o]===r||i[o].listener===r){a=i[o].listener,n=o;break}if(n<0)return this;n===0?i.shift():Eh(i,n),i.length===1&&(s[e]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};ee.prototype.off=ee.prototype.removeListener;ee.prototype.removeAllListeners=function(e){var r,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var n=Object.keys(i),o;for(s=0;s<n.length;++s)o=n[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(s=r.length-1;s>=0;s--)this.removeListener(e,r[s]);return this};function Kc(t,e,r){var i=t._events;if(i===void 0)return[];var s=i[e];return s===void 0?[]:typeof s=="function"?r?[s.listener||s]:[s]:r?_h(s):Hc(s,s.length)}ee.prototype.listeners=function(e){return Kc(this,e,!0)};ee.prototype.rawListeners=function(e){return Kc(this,e,!1)};ee.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Vc.call(t,e)};ee.prototype.listenerCount=Vc;function Vc(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ee.prototype.eventNames=function(){return this._eventsCount>0?Ni(this._events):[]};function Hc(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function Eh(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function _h(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Ih(t,e){return new Promise(function(r,i){function s(o){t.removeListener(e,n),i(o)}function n(){typeof t.removeListener=="function"&&t.removeListener("error",s),r([].slice.call(arguments))}Wc(t,e,n,{once:!0}),e!=="error"&&Dh(t,s,{once:!0})})}function Dh(t,e,r){typeof t.on=="function"&&Wc(t,"error",e,r)}function Wc(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(n){i.once&&t.removeEventListener(e,s),r(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var ot=Un.exports;const Gc=Mc(ot);var R={},ys={},Cr={},bo;function Sh(){if(bo)return Cr;bo=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Cr.delay=t,Cr}var Lt={},ws={},Bt={},vo;function Oh(){return vo||(vo=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.ONE_THOUSAND=Bt.ONE_HUNDRED=void 0,Bt.ONE_HUNDRED=100,Bt.ONE_THOUSAND=1e3),Bt}var ms={},Eo;function $h(){return Eo||(Eo=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(ms)),ms}var _o;function Yc(){return _o||(_o=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Zi;e.__exportStar(Oh(),t),e.__exportStar($h(),t)}(ws)),ws}var Io;function xh(){if(Io)return Lt;Io=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.fromMiliseconds=Lt.toMiliseconds=void 0;const t=Yc();function e(i){return i*t.ONE_THOUSAND}Lt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Lt.fromMiliseconds=r,Lt}var Do;function Th(){return Do||(Do=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Zi;e.__exportStar(Sh(),t),e.__exportStar(xh(),t)}(ys)),ys}var ar={},So;function Ah(){if(So)return ar;So=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return ar.Watch=t,ar.default=t,ar}var bs={},Lr={},Oo;function Ph(){if(Oo)return Lr;Oo=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.IWatch=void 0;class t{}return Lr.IWatch=t,Lr}var $o;function Nh(){return $o||($o=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Zi.__exportStar(Ph(),t)}(bs)),bs}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Zi;e.__exportStar(Th(),t),e.__exportStar(Ah(),t),e.__exportStar(Nh(),t),e.__exportStar(Yc(),t)})(R);class tr{}let Rh=class extends tr{constructor(e){super()}};const xo=R.FIVE_SECONDS,rr={pulse:"heartbeat_pulse"};let Ch=class Jc extends Rh{constructor(e){super(e),this.events=new ot.EventEmitter,this.interval=xo,this.interval=(e==null?void 0:e.interval)||xo}static async init(e){const r=new Jc(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),R.toMiliseconds(this.interval))}pulse(){this.events.emit(rr.pulse)}};const Lh=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Bh=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Uh=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function kh(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Mh(t);return}return e}function Mh(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function vi(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Uh.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Lh.test(t)||Bh.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,kh)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}var Zc=["buffer","Buffer"];function jh(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ye(t,...e){try{return jh(t(...e))}catch(r){return Promise.reject(r)}}function qh(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function zh(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Ri(t){if(qh(t))return String(t);if(zh(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Ri(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Zs="base64:";function Fh(t){return typeof t=="string"?t:Zs+Hh(t)}function Kh(t){return typeof t!="string"||!t.startsWith(Zs)?t:Vh(t.slice(Zs.length))}function Vh(t){return globalThis.Buffer?Zc.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Hh(t){return globalThis.Buffer?Zc.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ue(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Wh(...t){return Ue(t.join(":"))}function Ei(t){return t=Ue(t),t?t+":":""}function Gh(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function Yh(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const Jh="memory",Zh=()=>{const t=new Map;return{name:Jh,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Xh(t={}){const e={mounts:{"":t.driver||Zh()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(l,u)=>{if(e.watching){u=Ue(u);for(const h of e.watchListeners)h(l,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await To(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const d=new Map,f=p=>{let g=d.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},d.set(p.base,g)),g};for(const p of l){const g=typeof p=="string",y=Ue(g?p:p.key),m=g?void 0:p.value,w=g||!p.options?u:{...u,...p.options},b=r(y);f(b).items.push({key:y,value:m,relativeKey:b.relativeKey,options:w})}return Promise.all([...d.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(l,u={}){l=Ue(l);const{relativeKey:h,driver:d}=r(l);return ye(d.hasItem,h,u)},getItem(l,u={}){l=Ue(l);const{relativeKey:h,driver:d}=r(l);return ye(d.getItem,h,u).then(f=>vi(f))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?ye(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),u).then(d=>d.map(f=>({key:Wh(h.base,f.key),value:vi(f.value)}))):Promise.all(h.items.map(d=>ye(h.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:vi(f)})))))},getItemRaw(l,u={}){l=Ue(l);const{relativeKey:h,driver:d}=r(l);return d.getItemRaw?ye(d.getItemRaw,h,u):ye(d.getItem,h,u).then(f=>Kh(f))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Ue(l);const{relativeKey:d,driver:f}=r(l);f.setItem&&(await ye(f.setItem,d,Ri(u),h),f.watch||s("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return ye(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:Ri(d.value),options:d.options})),u);h.driver.setItem&&await Promise.all(h.items.map(d=>ye(h.driver.setItem,d.relativeKey,Ri(d.value),d.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Ue(l);const{relativeKey:d,driver:f}=r(l);if(f.setItemRaw)await ye(f.setItemRaw,d,u,h);else if(f.setItem)await ye(f.setItem,d,Fh(u),h);else return;f.watch||s("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Ue(l);const{relativeKey:h,driver:d}=r(l);d.removeItem&&(await ye(d.removeItem,h,u),(u.removeMeta||u.removeMata)&&await ye(d.removeItem,h+"$",u),d.watch||s("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Ue(l);const{relativeKey:h,driver:d}=r(l),f=Object.create(null);if(d.getMeta&&Object.assign(f,await ye(d.getMeta,h,u)),!u.nativeOnly){const p=await ye(d.getItem,h+"$",u).then(g=>vi(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(f,p))}return f},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var y;l=Ei(l);const h=i(l,!0);let d=[];const f=[];let p=!0;for(const m of h){(y=m.driver.flags)!=null&&y.maxDepth||(p=!1);const w=await ye(m.driver.getKeys,m.relativeBase,u);for(const b of w){const E=m.mountpoint+Ue(b);d.some(O=>E.startsWith(O))||f.push(E)}d=[m.mountpoint,...d.filter(b=>!b.startsWith(m.mountpoint))]}const g=u.maxDepth!==void 0&&!p;return f.filter(m=>(!g||Gh(m,u.maxDepth))&&Yh(m,l))},async clear(l,u={}){l=Ei(l),await Promise.all(i(l,!1).map(async h=>{if(h.driver.clear)return ye(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(d.map(f=>h.driver.removeItem(f,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Ao(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=Ei(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(To(u,s,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,d;l=Ei(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((d=(h=e.unwatch)[l])==null||d.call(h),delete e.unwatch[l]),u&&await Ao(e.mounts[l]),e.mountpoints=e.mountpoints.filter(f=>f!==l),delete e.mounts[l])},getMount(l=""){l=Ue(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Ue(l),i(l,u.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function To(t,e,r){return t.watch?t.watch((i,s)=>e(i,r+s)):()=>{}}async function Ao(t){typeof t.dispose=="function"&&await ye(t.dispose)}function ir(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Xc(t,e){let r;const i=()=>{if(r)return r;const s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),r=ir(s),r.then(n=>{n.onclose=()=>r=void 0},()=>{}),r};return(s,n)=>i().then(o=>n(o.transaction(e,s).objectStore(e)))}let vs;function ai(){return vs||(vs=Xc("keyval-store","keyval")),vs}function Po(t,e=ai()){return e("readonly",r=>ir(r.get(t)))}function Qh(t,e,r=ai()){return r("readwrite",i=>(i.put(e,t),ir(i.transaction)))}function ed(t,e=ai()){return e("readwrite",r=>(r.delete(t),ir(r.transaction)))}function td(t=ai()){return t("readwrite",e=>(e.clear(),ir(e.transaction)))}function rd(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},ir(t.transaction)}function id(t=ai()){return t("readonly",e=>{if(e.getAllKeys)return ir(e.getAllKeys());const r=[];return rd(e,i=>r.push(i.key)).then(()=>r)})}const sd=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),nd=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function mr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return nd(t)}catch{return t}}function Yt(t){return typeof t=="string"?t:sd(t)||""}const od="idb-keyval";var ad=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let i;return t.dbName&&t.storeName&&(i=Xc(t.dbName,t.storeName)),{name:od,options:t,async hasItem(s){return!(typeof await Po(r(s),i)>"u")},async getItem(s){return await Po(r(s),i)??null},setItem(s,n){return Qh(r(s),n,i)},removeItem(s){return ed(r(s),i)},getKeys(){return id(i)},clear(){return td(i)}}};const cd="WALLET_CONNECT_V2_INDEXED_DB",ld="keyvaluestorage";let ud=class{constructor(){this.indexedDb=Xh({driver:ad({dbName:cd,storeName:ld})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Yt(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Es=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},Ci={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Es<"u"&&Es.localStorage?Ci.exports=Es.localStorage:typeof window<"u"&&window.localStorage?Ci.exports=window.localStorage:Ci.exports=new e})();function hd(t){var e;return[t[0],mr((e=t[1])!=null?e:"")]}let dd=class{constructor(){this.localStorage=Ci.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(hd)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return mr(r)}async setItem(e,r){this.localStorage.setItem(e,Yt(r))}async removeItem(e){this.localStorage.removeItem(e)}};const pd="wc_storage_version",No=1,fd=async(t,e,r)=>{const i=pd,s=await e.getItem(i);if(s&&s>=No){r(e);return}const n=await t.getKeys();if(!n.length){r(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,No),r(e),gd(t,o)},gd=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let yd=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new dd;this.storage=e;try{const r=new ud;fd(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};function wd(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var md=bd;function bd(t,e,r){var i=r&&r.stringify||wd,s=1;if(typeof t=="object"&&t!==null){var n=e.length+s;if(n===1)return t;var o=new Array(n);o[0]=i(t);for(var a=1;a<n;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var l="",u=1-s,h=-1,d=t&&t.length||0,f=0;f<d;){if(t.charCodeAt(f)===37&&f+1<d){switch(h=h>-1?h:0,t.charCodeAt(f+1)){case 100:case 102:if(u>=c||e[u]==null)break;h<f&&(l+=t.slice(h,f)),l+=Number(e[u]),h=f+2,f++;break;case 105:if(u>=c||e[u]==null)break;h<f&&(l+=t.slice(h,f)),l+=Math.floor(Number(e[u])),h=f+2,f++;break;case 79:case 111:case 106:if(u>=c||e[u]===void 0)break;h<f&&(l+=t.slice(h,f));var p=typeof e[u];if(p==="string"){l+="'"+e[u]+"'",h=f+2,f++;break}if(p==="function"){l+=e[u].name||"<anonymous>",h=f+2,f++;break}l+=i(e[u]),h=f+2,f++;break;case 115:if(u>=c)break;h<f&&(l+=t.slice(h,f)),l+=String(e[u]),h=f+2,f++;break;case 37:h<f&&(l+=t.slice(h,f)),l+="%",h=f+2,f++,u--;break}++u}++f}return h===-1?t:(h<d&&(l+=t.slice(h)),l)}const Ro=md;var gr=pt;const Xr=Td().console||{},vd={mapHttpRequest:_i,mapHttpResponse:_i,wrapRequestSerializer:_s,wrapResponseSerializer:_s,wrapErrorSerializer:_s,req:_i,res:_i,err:Sd};function Ed(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function pt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Xr;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},s=Ed(t.browser.serialize,i);let n=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(n=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=Qr),Object.defineProperty(c,"levelVal",{get:u}),Object.defineProperty(c,"level",{get:h,set:d});const l={transmit:e,serialize:s,asObject:t.browser.asObject,levels:o,timestamp:Od(t)};c.levels=pt.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Qr,c.serializers=i,c._serialize=s,c._stdErrSerialize=n,c.child=f,e&&(c._logEvent=Xs());function u(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function d(p){if(p!=="silent"&&!this.levels.values[p])throw Error("unknown level "+p);this._level=p,cr(l,c,"error","log"),cr(l,c,"fatal","error"),cr(l,c,"warn","error"),cr(l,c,"info","log"),cr(l,c,"debug","log"),cr(l,c,"trace","log")}function f(p,g){if(!p)throw new Error("missing bindings for child Pino");g=g||{},s&&p.serializers&&(g.serializers=p.serializers);const y=g.serializers;if(s&&y){var m=Object.assign({},i,y),w=t.browser.serialize===!0?Object.keys(m):s;delete p.serializers,Qi([p],w,m,this._stdErrSerialize)}function b(E){this._childLevel=(E._childLevel|0)+1,this.error=lr(E,p,"error"),this.fatal=lr(E,p,"fatal"),this.warn=lr(E,p,"warn"),this.info=lr(E,p,"info"),this.debug=lr(E,p,"debug"),this.trace=lr(E,p,"trace"),m&&(this.serializers=m,this._serialize=w),e&&(this._logEvent=Xs([].concat(E._logEvent.bindings,p)))}return b.prototype=this,new b(this)}return c}pt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};pt.stdSerializers=vd;pt.stdTimeFunctions=Object.assign({},{nullTime:Qc,epochTime:el,unixTime:$d,isoTime:xd});function cr(t,e,r,i){const s=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Qr:s[r]?s[r]:Xr[r]||Xr[i]||Qr,_d(t,e,r)}function _d(t,e,r){!t.transmit&&e[r]===Qr||(e[r]=function(i){return function(){const n=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Xr?Xr:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&Qi(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(a,Id(this,r,o,n)):i.apply(a,o),t.transmit){const l=t.transmit.level||e.level,u=pt.levels.values[l],h=pt.levels.values[r];if(h<u)return;Dd(this,{ts:n,methodLevel:r,methodValue:h,transmitValue:pt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function Id(t,e,r,i){t._serialize&&Qi(r,t._serialize,t.serializers,t._stdErrSerialize);const s=r.slice();let n=s[0];const o={};i&&(o.time=i),o.level=pt.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),n!==null&&typeof n=="object"){for(;a--&&typeof s[0]=="object";)Object.assign(o,s.shift());n=s.length?Ro(s.shift(),s):void 0}else typeof n=="string"&&(n=Ro(s.shift(),s));return n!==void 0&&(o.msg=n),o}function Qi(t,e,r,i){for(const s in t)if(i&&t[s]instanceof Error)t[s]=pt.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s]))for(const n in t[s])e&&e.indexOf(n)>-1&&n in r&&(t[s][n]=r[n](t[s][n]))}function lr(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return t[r].apply(this,i)}}function Dd(t,e,r){const i=e.send,s=e.ts,n=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;Qi(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(l){return c.indexOf(l)===-1}),t._logEvent.level.label=n,t._logEvent.level.value=o,i(n,t._logEvent,a),t._logEvent=Xs(c)}function Xs(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function Sd(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Od(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Qc:el}function _i(){return{}}function _s(t){return t}function Qr(){}function Qc(){return!1}function el(){return Date.now()}function $d(){return Math.round(Date.now()/1e3)}function xd(){return new Date(Date.now()).toISOString()}function Td(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const es=Mc(gr),Ad={level:"info"},ci="custom_context",kn=1e3*1024;let Pd=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Co=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Pd(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}},tl=class{constructor(e,r=kn){this.level=e??"error",this.levelValue=gr.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Co(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===gr.levels.values.error?console.error(e):r===gr.levels.values.warn?console.warn(e):r===gr.levels.values.debug?console.debug(e):r===gr.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Yt({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Co(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Yt({extraMetadata:e})),new Blob(r,{type:"application/json"})}},Nd=class{constructor(e,r=kn){this.baseChunkLogger=new tl(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}},Rd=class{constructor(e,r=kn){this.baseChunkLogger=new tl(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Cd=Object.defineProperty,Ld=Object.defineProperties,Bd=Object.getOwnPropertyDescriptors,Lo=Object.getOwnPropertySymbols,Ud=Object.prototype.hasOwnProperty,kd=Object.prototype.propertyIsEnumerable,Bo=(t,e,r)=>e in t?Cd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zi=(t,e)=>{for(var r in e||(e={}))Ud.call(e,r)&&Bo(t,r,e[r]);if(Lo)for(var r of Lo(e))kd.call(e,r)&&Bo(t,r,e[r]);return t},Fi=(t,e)=>Ld(t,Bd(e));function Mn(t){return Fi(zi({},t),{level:(t==null?void 0:t.level)||Ad.level})}function Md(t,e=ci){return t[e]||""}function jd(t,e,r=ci){return t[r]=e,t}function qe(t,e=ci){let r="";return typeof t.bindings>"u"?r=Md(t,e):r=t.bindings().context||"",r}function qd(t,e,r=ci){const i=qe(t,r);return i.trim()?`${i}/${e}`:e}function Ce(t,e,r=ci){const i=qd(t,e,r),s=t.child({context:i});return jd(s,i,r)}function zd(t){var e,r;const i=new Nd((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:es(Fi(zi({},t.opts),{level:"trace",browser:Fi(zi({},(r=t.opts)==null?void 0:r.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function Fd(t){var e;const r=new Rd((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:es(Fi(zi({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function Kd(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?zd(t):Fd(t)}var Vd=Object.defineProperty,Hd=(t,e,r)=>e in t?Vd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Uo=(t,e,r)=>Hd(t,typeof e!="symbol"?e+"":e,r);let Wd=class extends tr{constructor(e){super(),this.opts=e,Uo(this,"protocol","wc"),Uo(this,"version",2)}};var Gd=Object.defineProperty,Yd=(t,e,r)=>e in t?Gd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jd=(t,e,r)=>Yd(t,e+"",r);class Zd extends tr{constructor(e,r){super(),this.core=e,this.logger=r,Jd(this,"records",new Map)}}let Xd=class{constructor(e,r){this.logger=e,this.core=r}};class Qd extends tr{constructor(e,r){super(),this.relayer=e,this.logger=r}}let ep=class extends tr{constructor(e){super()}},tp=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}},rp=class extends tr{constructor(e,r){super(),this.relayer=e,this.logger=r}},ip=class extends tr{constructor(e,r){super(),this.core=e,this.logger=r}},sp=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},np=class{constructor(e,r){this.projectId=e,this.logger=r}};class op{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}}var ap=Object.defineProperty,cp=(t,e,r)=>e in t?ap(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ko=(t,e,r)=>cp(t,typeof e!="symbol"?e+"":e,r);let lp=class{constructor(e){this.opts=e,ko(this,"protocol","wc"),ko(this,"version",2)}},up=class{constructor(e){this.client=e}};function hp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rl(t,...e){if(!hp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Mo(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function dp(t,e){rl(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ur=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Is=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function pp(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function il(t){return typeof t=="string"&&(t=pp(t)),rl(t),t}let fp=class{clone(){return this._cloneInto()}};function gp(t){const e=i=>t().update(il(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function sl(t=32){if(ur&&typeof ur.getRandomValues=="function")return ur.getRandomValues(new Uint8Array(t));if(ur&&typeof ur.randomBytes=="function")return ur.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function yp(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}let wp=class extends fp{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Is(this.buffer)}update(e){Mo(this);const{view:r,buffer:i,blockLen:s}=this;e=il(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Is(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Mo(this),dp(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;yp(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Is(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%r&&e.buffer.set(i),e}};const Ii=BigInt(2**32-1),Qs=BigInt(32);function nl(t,e=!1){return e?{h:Number(t&Ii),l:Number(t>>Qs&Ii)}:{h:Number(t>>Qs&Ii)|0,l:Number(t&Ii)|0}}function mp(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=nl(t[s],e);[r[s],i[s]]=[n,o]}return[r,i]}const bp=(t,e)=>BigInt(t>>>0)<<Qs|BigInt(e>>>0),vp=(t,e,r)=>t>>>r,Ep=(t,e,r)=>t<<32-r|e>>>r,_p=(t,e,r)=>t>>>r|e<<32-r,Ip=(t,e,r)=>t<<32-r|e>>>r,Dp=(t,e,r)=>t<<64-r|e>>>r-32,Sp=(t,e,r)=>t>>>r-32|e<<64-r,Op=(t,e)=>e,$p=(t,e)=>t,xp=(t,e,r)=>t<<r|e>>>32-r,Tp=(t,e,r)=>e<<r|t>>>32-r,Ap=(t,e,r)=>e<<r-32|t>>>64-r,Pp=(t,e,r)=>t<<r-32|e>>>64-r;function Np(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Rp=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Cp=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,Lp=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Bp=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,Up=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),kp=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,K={fromBig:nl,split:mp,toBig:bp,shrSH:vp,shrSL:Ep,rotrSH:_p,rotrSL:Ip,rotrBH:Dp,rotrBL:Sp,rotr32H:Op,rotr32L:$p,rotlSH:xp,rotlSL:Tp,rotlBH:Ap,rotlBL:Pp,add:Np,add3L:Rp,add3H:Cp,add4L:Lp,add4H:Bp,add5H:kp,add5L:Up},[Mp,jp]=K.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Ot=new Uint32Array(80),$t=new Uint32Array(80);let qp=class extends wp{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:f,Gl:p,Hh:g,Hl:y}=this;return[e,r,i,s,n,o,a,c,l,u,h,d,f,p,g,y]}set(e,r,i,s,n,o,a,c,l,u,h,d,f,p,g,y){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=y|0}process(e,r){for(let b=0;b<16;b++,r+=4)Ot[b]=e.getUint32(r),$t[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const E=Ot[b-15]|0,O=$t[b-15]|0,$=K.rotrSH(E,O,1)^K.rotrSH(E,O,8)^K.shrSH(E,O,7),S=K.rotrSL(E,O,1)^K.rotrSL(E,O,8)^K.shrSL(E,O,7),T=Ot[b-2]|0,I=$t[b-2]|0,j=K.rotrSH(T,I,19)^K.rotrBH(T,I,61)^K.shrSH(T,I,6),B=K.rotrSL(T,I,19)^K.rotrBL(T,I,61)^K.shrSL(T,I,6),k=K.add4L(S,B,$t[b-7],$t[b-16]),q=K.add4H(k,$,j,Ot[b-7],Ot[b-16]);Ot[b]=q|0,$t[b]=k|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:f,Fl:p,Gh:g,Gl:y,Hh:m,Hl:w}=this;for(let b=0;b<80;b++){const E=K.rotrSH(h,d,14)^K.rotrSH(h,d,18)^K.rotrBH(h,d,41),O=K.rotrSL(h,d,14)^K.rotrSL(h,d,18)^K.rotrBL(h,d,41),$=h&f^~h&g,S=d&p^~d&y,T=K.add5L(w,O,S,jp[b],$t[b]),I=K.add5H(T,m,E,$,Mp[b],Ot[b]),j=T|0,B=K.rotrSH(i,s,28)^K.rotrBH(i,s,34)^K.rotrBH(i,s,39),k=K.rotrSL(i,s,28)^K.rotrBL(i,s,34)^K.rotrBL(i,s,39),q=i&n^i&a^n&a,P=s&o^s&c^o&c;m=g|0,w=y|0,g=f|0,y=p|0,f=h|0,p=d|0,{h,l:d}=K.add(l|0,u|0,I|0,j|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const _=K.add3L(j,k,P);i=K.add3H(_,I,B,q),s=_|0}({h:i,l:s}=K.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=K.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=K.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=K.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=K.add(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=K.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:y}=K.add(this.Gh|0,this.Gl|0,g|0,y|0),{h:m,l:w}=K.add(this.Hh|0,this.Hl|0,m|0,w|0),this.set(i,s,n,o,a,c,l,u,h,d,f,p,g,y,m,w)}roundClean(){Ot.fill(0),$t.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const zp=gp(()=>new qp);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const jn=BigInt(0),ol=BigInt(1),Fp=BigInt(2);function qn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function zn(t){if(!qn(t))throw new Error("Uint8Array expected")}function Ds(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Kp=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Fn(t){zn(t);let e="";for(let r=0;r<t.length;r++)e+=Kp[t[r]];return e}function al(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?jn:BigInt("0x"+t)}const gt={_0:48,_9:57,A:65,F:70,a:97,f:102};function jo(t){if(t>=gt._0&&t<=gt._9)return t-gt._0;if(t>=gt.A&&t<=gt.F)return t-(gt.A-10);if(t>=gt.a&&t<=gt.f)return t-(gt.a-10)}function cl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=jo(t.charCodeAt(n)),a=jo(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Vp(t){return al(Fn(t))}function Li(t){return zn(t),al(Fn(Uint8Array.from(t).reverse()))}function ll(t,e){return cl(t.toString(16).padStart(e*2,"0"))}function en(t,e){return ll(t,e).reverse()}function yt(t,e,r){let i;if(typeof e=="string")try{i=cl(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(qn(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function qo(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];zn(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const Ss=t=>typeof t=="bigint"&&jn<=t;function Hp(t,e,r){return Ss(t)&&Ss(e)&&Ss(r)&&e<=t&&t<r}function Br(t,e,r,i){if(!Hp(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Wp(t){let e;for(e=0;t>jn;t>>=ol,e+=1);return e}const Gp=t=>(Fp<<BigInt(t-1))-ol,Yp={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||qn(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Kn(t,e,r={}){const i=(s,n,o)=>{const a=Yp[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function zo(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const be=BigInt(0),ce=BigInt(1),qt=BigInt(2),Jp=BigInt(3),tn=BigInt(4),Fo=BigInt(5),Ko=BigInt(8);function fe(t,e){const r=t%e;return r>=be?r:e+r}function Zp(t,e,r){if(e<be)throw new Error("invalid exponent, negatives unsupported");if(r<=be)throw new Error("invalid modulus");if(r===ce)return be;let i=ce;for(;e>be;)e&ce&&(i=i*t%r),t=t*t%r,e>>=ce;return i}function at(t,e,r){let i=t;for(;e-- >be;)i*=i,i%=r;return i}function Vo(t,e){if(t===be)throw new Error("invert: expected non-zero number");if(e<=be)throw new Error("invert: expected positive modulus, got "+e);let r=fe(t,e),i=e,s=be,n=ce;for(;r!==be;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==ce)throw new Error("invert: does not exist");return fe(s,e)}function Xp(t){const e=(t-ce)/qt;let r,i,s;for(r=t-ce,i=0;r%qt===be;r/=qt,i++);for(s=qt;s<t&&Zp(s,e,t)!==t-ce;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+ce)/tn;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(r+ce)/qt;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,s),r),u=o.pow(a,n),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(h);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(l,ce<<BigInt(c-d-1));l=o.sqr(f),u=o.mul(u,f),h=o.mul(h,l),c=d}return u}}function Qp(t){if(t%tn===Jp){const e=(t+ce)/tn;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%Ko===Fo){const e=(t-Fo)/Ko;return function(r,i){const s=r.mul(i,qt),n=r.pow(s,e),o=r.mul(i,n),a=r.mul(r.mul(o,qt),n),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return Xp(t)}const ef=(t,e)=>(fe(t,e)&ce)===ce,tf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function rf(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=tf.reduce((i,s)=>(i[s]="function",i),e);return Kn(t,r)}function sf(t,e,r){if(r<be)throw new Error("invalid exponent, negatives unsupported");if(r===be)return t.ONE;if(r===ce)return e;let i=t.ONE,s=e;for(;r>be;)r&ce&&(i=t.mul(i,s)),s=t.sqr(s),r>>=ce;return i}function nf(t,e){const r=new Array(e.length),i=e.reduce((n,o,a)=>t.is0(o)?n:(r[a]=n,t.mul(n,o)),t.ONE),s=t.inv(i);return e.reduceRight((n,o,a)=>t.is0(o)?n:(r[a]=t.mul(n,r[a]),t.mul(n,o)),s),r}function ul(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function hl(t,e,r=!1,i={}){if(t<=be)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=ul(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:Gp(s),ZERO:be,ONE:ce,create:c=>fe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return be<=c&&c<t},is0:c=>c===be,isOdd:c=>(c&ce)===ce,neg:c=>fe(-c,t),eql:(c,l)=>c===l,sqr:c=>fe(c*c,t),add:(c,l)=>fe(c+l,t),sub:(c,l)=>fe(c-l,t),mul:(c,l)=>fe(c*l,t),pow:(c,l)=>sf(a,c,l),div:(c,l)=>fe(c*Vo(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Vo(c,t),sqrt:i.sqrt||(c=>(o||(o=Qp(t)),o(a,c))),invertBatch:c=>nf(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?en(c,n):ll(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?Li(c):Vp(c)}});return Object.freeze(a)}const Ho=BigInt(0),Di=BigInt(1);function Os(t,e){const r=e.negate();return t?r:e}function dl(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function $s(t,e){dl(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function of(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function af(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const xs=new WeakMap,pl=new WeakMap;function Ts(t){return pl.get(t)||1}function cf(t,e){return{constTimeNegate:Os,hasPrecomputes(r){return Ts(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>Ho;)i&Di&&(s=s.add(n)),n=n.double(),i>>=Di;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=$s(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){const{windows:n,windowSize:o}=$s(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let d=0;d<n;d++){const f=d*o;let p=Number(s&l);s>>=h,p>o&&(p-=u,s+=Di);const g=f,y=f+Math.abs(p)-1,m=d%2!==0,w=p<0;p===0?c=c.add(Os(m,i[g])):a=a.add(Os(w,i[y]))}return{p:a,f:c}},wNAFUnsafe(r,i,s,n=t.ZERO){const{windows:o,windowSize:a}=$s(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const d=h*a;if(s===Ho)break;let f=Number(s&c);if(s>>=u,f>a&&(f-=l,s+=Di),f===0)continue;let p=i[d+Math.abs(f)-1];f<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(r,i,s){let n=xs.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&xs.set(i,s(n))),n},wNAFCached(r,i,s){const n=Ts(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=Ts(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){dl(i,e),pl.set(r,i),xs.delete(r)}}}function lf(t,e,r,i){if(of(r,t),af(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=Wp(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let f=0;f<i.length;f++){const p=i[f],g=Number(p>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[f])}let d=s;for(let f=c.length-1,p=s;f>0;f--)p=p.add(c[f]),d=d.add(p);if(u=u.add(d),h!==0)for(let f=0;f<o;f++)u=u.double()}return u}function uf(t){return rf(t.Fp),Kn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ul(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Qe=BigInt(0),Le=BigInt(1),Si=BigInt(2),hf=BigInt(8),df={zip215:!0};function pf(t){const e=uf(t);return Kn(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function ff(t){const e=pf(t),{Fp:r,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,l=Si<<BigInt(a*8)-Le,u=r.create,h=hl(e.n,e.nBitLength),d=e.uvRatio||((_,v)=>{try{return{isValid:!0,value:r.sqrt(_*r.inv(v))}}catch{return{isValid:!1,value:Qe}}}),f=e.adjustScalarBytes||(_=>_),p=e.domain||((_,v,x)=>{if(Ds("phflag",x),v.length||x)throw new Error("Contexts/pre-hash are not supported");return _});function g(_,v){Br("coordinate "+_,v,Qe,l)}function y(_){if(!(_ instanceof b))throw new Error("ExtendedPoint expected")}const m=zo((_,v)=>{const{ex:x,ey:A,ez:D}=_,C=_.is0();v==null&&(v=C?hf:r.inv(D));const U=u(x*v),M=u(A*v),z=u(D*v);if(C)return{x:Qe,y:Le};if(z!==Le)throw new Error("invZ was invalid");return{x:U,y:M}}),w=zo(_=>{const{a:v,d:x}=e;if(_.is0())throw new Error("bad point: ZERO");const{ex:A,ey:D,ez:C,et:U}=_,M=u(A*A),z=u(D*D),F=u(C*C),V=u(F*F),G=u(M*v),ie=u(F*u(G+z)),Q=u(V+u(x*u(M*z)));if(ie!==Q)throw new Error("bad point: equation left != right (1)");const Y=u(A*D),Te=u(C*U);if(Y!==Te)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(v,x,A,D){this.ex=v,this.ey=x,this.ez=A,this.et=D,g("x",v),g("y",x),g("z",A),g("t",D),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(v){if(v instanceof b)throw new Error("extended point not allowed");const{x,y:A}=v||{};return g("x",x),g("y",A),new b(x,A,Le,u(x*A))}static normalizeZ(v){const x=r.invertBatch(v.map(A=>A.ez));return v.map((A,D)=>A.toAffine(x[D])).map(b.fromAffine)}static msm(v,x){return lf(b,h,v,x)}_setWindowSize(v){$.setWindowSize(this,v)}assertValidity(){w(this)}equals(v){y(v);const{ex:x,ey:A,ez:D}=this,{ex:C,ey:U,ez:M}=v,z=u(x*M),F=u(C*D),V=u(A*M),G=u(U*D);return z===F&&V===G}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:v}=e,{ex:x,ey:A,ez:D}=this,C=u(x*x),U=u(A*A),M=u(Si*u(D*D)),z=u(v*C),F=x+A,V=u(u(F*F)-C-U),G=z+U,ie=G-M,Q=z-U,Y=u(V*ie),Te=u(G*Q),Ee=u(V*Q),Pe=u(ie*G);return new b(Y,Te,Pe,Ee)}add(v){y(v);const{a:x,d:A}=e,{ex:D,ey:C,ez:U,et:M}=this,{ex:z,ey:F,ez:V,et:G}=v;if(x===BigInt(-1)){const lo=u((C-D)*(F+z)),uo=u((C+D)*(F-z)),gs=u(uo-lo);if(gs===Qe)return this.double();const ho=u(U*Si*G),po=u(M*Si*V),fo=po+ho,go=uo+lo,yo=po-ho,dh=u(fo*gs),ph=u(go*yo),fh=u(fo*yo),gh=u(gs*go);return new b(dh,ph,gh,fh)}const ie=u(D*z),Q=u(C*F),Y=u(M*A*G),Te=u(U*V),Ee=u((D+C)*(z+F)-ie-Q),Pe=Te-Y,We=Te+Y,Ge=u(Q-x*ie),or=u(Ee*Pe),lh=u(We*Ge),uh=u(Ee*Ge),hh=u(Pe*We);return new b(or,lh,hh,uh)}subtract(v){return this.add(v.negate())}wNAF(v){return $.wNAFCached(this,v,b.normalizeZ)}multiply(v){const x=v;Br("scalar",x,Le,i);const{p:A,f:D}=this.wNAF(x);return b.normalizeZ([A,D])[0]}multiplyUnsafe(v,x=b.ZERO){const A=v;return Br("scalar",A,Qe,i),A===Qe?O:this.is0()||A===Le?this:$.wNAFCachedUnsafe(this,A,b.normalizeZ,x)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return $.unsafeLadder(this,i).is0()}toAffine(v){return m(this,v)}clearCofactor(){const{h:v}=e;return v===Le?this:this.multiplyUnsafe(v)}static fromHex(v,x=!1){const{d:A,a:D}=e,C=r.BYTES;v=yt("pointHex",v,C),Ds("zip215",x);const U=v.slice(),M=v[C-1];U[C-1]=M&-129;const z=Li(U),F=x?l:r.ORDER;Br("pointHex.y",z,Qe,F);const V=u(z*z),G=u(V-Le),ie=u(A*V-D);let{isValid:Q,value:Y}=d(G,ie);if(!Q)throw new Error("Point.fromHex: invalid y coordinate");const Te=(Y&Le)===Le,Ee=(M&128)!==0;if(!x&&Y===Qe&&Ee)throw new Error("Point.fromHex: x=0 and x_0=1");return Ee!==Te&&(Y=u(-Y)),b.fromAffine({x:Y,y:z})}static fromPrivateKey(v){return I(v).point}toRawBytes(){const{x:v,y:x}=this.toAffine(),A=en(x,r.BYTES);return A[A.length-1]|=v&Le?128:0,A}toHex(){return Fn(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Le,u(e.Gx*e.Gy)),b.ZERO=new b(Qe,Le,Le,Qe);const{BASE:E,ZERO:O}=b,$=cf(b,a*8);function S(_){return fe(_,i)}function T(_){return S(Li(_))}function I(_){const v=r.BYTES;_=yt("private key",_,v);const x=yt("hashed private key",n(_),2*v),A=f(x.slice(0,v)),D=x.slice(v,2*v),C=T(A),U=E.multiply(C),M=U.toRawBytes();return{head:A,prefix:D,scalar:C,point:U,pointBytes:M}}function j(_){return I(_).pointBytes}function B(_=new Uint8Array,...v){const x=qo(...v);return T(n(p(x,yt("context",_),!!s)))}function k(_,v,x={}){_=yt("message",_),s&&(_=s(_));const{prefix:A,scalar:D,pointBytes:C}=I(v),U=B(x.context,A,_),M=E.multiply(U).toRawBytes(),z=B(x.context,M,C,_),F=S(U+z*D);Br("signature.s",F,Qe,i);const V=qo(M,en(F,r.BYTES));return yt("result",V,r.BYTES*2)}const q=df;function P(_,v,x,A=q){const{context:D,zip215:C}=A,U=r.BYTES;_=yt("signature",_,2*U),v=yt("message",v),x=yt("publicKey",x,U),C!==void 0&&Ds("zip215",C),s&&(v=s(v));const M=Li(_.slice(U,2*U));let z,F,V;try{z=b.fromHex(x,C),F=b.fromHex(_.slice(0,U),C),V=E.multiplyUnsafe(M)}catch{return!1}if(!C&&z.isSmallOrder())return!1;const G=B(D,F.toRawBytes(),z.toRawBytes(),v);return F.add(z.multiplyUnsafe(G)).subtract(V).clearCofactor().equals(b.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:k,verify:P,ExtendedPoint:b,utils:{getExtendedPublicKey:I,randomPrivateKey:()=>o(r.BYTES),precompute(_=8,v=b.BASE){return v._setWindowSize(_),v.multiply(BigInt(3)),v}}}}BigInt(0),BigInt(1);const Vn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Wo=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const gf=BigInt(1),Go=BigInt(2);BigInt(3);const yf=BigInt(5),wf=BigInt(8);function mf(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=Vn,o=t*t%n*t%n,a=at(o,Go,n)*o%n,c=at(a,gf,n)*t%n,l=at(c,yf,n)*c%n,u=at(l,e,n)*l%n,h=at(u,r,n)*u%n,d=at(h,i,n)*h%n,f=at(d,s,n)*d%n,p=at(f,s,n)*d%n,g=at(p,e,n)*l%n;return{pow_p_5_8:at(g,Go,n)*t%n,b2:o}}function bf(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function vf(t,e){const r=Vn,i=fe(e*e*e,r),s=fe(i*i*e,r),n=mf(t*s).pow_p_5_8;let o=fe(t*i*n,r);const a=fe(e*o*o,r),c=o,l=fe(o*Wo,r),u=a===t,h=a===fe(-t,r),d=a===fe(-t*Wo,r);return u&&(o=c),(h||d)&&(o=l),ef(o,r)&&(o=fe(-o,r)),{isValid:u||h,value:o}}const Ef=hl(Vn,void 0,!0),_f={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Ef,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:wf,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:zp,randomBytes:sl,adjustScalarBytes:bf,uvRatio:vf},fl=ff(_f),If="EdDSA",Df="JWT",Ki=".",ts="base64url",gl="utf8",yl="utf8",Sf=":",Of="did",$f="key",Yo="base58btc",xf="z",Tf="K36",Af=32;function Hn(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function wl(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Hn(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ml(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=wl(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Hn(r)}function Pf(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,m=0,w=p.length;m!==w&&p[m]===0;)m++,g++;for(var b=(w-m)*u+1>>>0,E=new Uint8Array(b);m!==w;){for(var O=p[m],$=0,S=b-1;(O!==0||$<y)&&S!==-1;S--,$++)O+=256*E[S]>>>0,E[S]=O%a>>>0,O=O/a>>>0;if(O!==0)throw new Error("Non-zero carry");y=$,m++}for(var T=b-y;T!==b&&E[T]===0;)T++;for(var I=c.repeat(g);T<b;++T)I+=t.charAt(E[T]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,m=0;p[g]===c;)y++,g++;for(var w=(p.length-g)*l+1>>>0,b=new Uint8Array(w);p[g];){var E=r[p.charCodeAt(g)];if(E===255)return;for(var O=0,$=w-1;(E!==0||O<m)&&$!==-1;$--,O++)E+=a*b[$]>>>0,b[$]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=O,g++}if(p[g]!==" "){for(var S=w-m;S!==w&&b[S]===0;)S++;for(var T=new Uint8Array(y+(w-S)),I=y;S!==w;)T[I++]=b[S++];return T}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var Nf=Pf,Rf=Nf;const bl=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Cf=t=>new TextEncoder().encode(t),Lf=t=>new TextDecoder().decode(t);let Bf=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Uf=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vl(this,e)}},kf=class{constructor(e){this.decoders=e}or(e){return vl(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const vl=(t,e)=>new kf({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Mf=class{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Bf(e,r,i),this.decoder=new Uf(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const rs=({name:t,prefix:e,encode:r,decode:i})=>new Mf(t,e,r,i),li=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Rf(r,e);return rs({prefix:t,name:e,encode:i,decode:n=>bl(s(n))})},jf=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},qf=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Oe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>rs({prefix:e,name:t,encode(s){return qf(s,i,r)},decode(s){return jf(s,i,r,t)}}),zf=rs({prefix:"\0",name:"identity",encode:t=>Lf(t),decode:t=>Cf(t)});var Ff=Object.freeze({__proto__:null,identity:zf});const Kf=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Vf=Object.freeze({__proto__:null,base2:Kf});const Hf=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Wf=Object.freeze({__proto__:null,base8:Hf});const Gf=li({prefix:"9",name:"base10",alphabet:"0123456789"});var Yf=Object.freeze({__proto__:null,base10:Gf});const Jf=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Zf=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Xf=Object.freeze({__proto__:null,base16:Jf,base16upper:Zf});const Qf=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),eg=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),tg=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rg=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ig=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sg=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ng=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),og=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ag=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var cg=Object.freeze({__proto__:null,base32:Qf,base32upper:eg,base32pad:tg,base32padupper:rg,base32hex:ig,base32hexupper:sg,base32hexpad:ng,base32hexpadupper:og,base32z:ag});const lg=li({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ug=li({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var hg=Object.freeze({__proto__:null,base36:lg,base36upper:ug});const dg=li({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),pg=li({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fg=Object.freeze({__proto__:null,base58btc:dg,base58flickr:pg});const gg=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),yg=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wg=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mg=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var bg=Object.freeze({__proto__:null,base64:gg,base64pad:yg,base64url:wg,base64urlpad:mg});const El=Array.from(""),vg=El.reduce((t,e,r)=>(t[r]=e,t),[]),Eg=El.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function _g(t){return t.reduce((e,r)=>(e+=vg[r],e),"")}function Ig(t){const e=[];for(const r of t){const i=Eg[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Dg=rs({prefix:"",name:"base256emoji",encode:_g,decode:Ig});var Sg=Object.freeze({__proto__:null,base256emoji:Dg}),Og=_l,Jo=128,$g=-128,xg=Math.pow(2,31);function _l(t,e,r){e=e||[],r=r||0;for(var i=r;t>=xg;)e[r++]=t&255|Jo,t/=128;for(;t&$g;)e[r++]=t&255|Jo,t>>>=7;return e[r]=t|0,_l.bytes=r-i+1,e}var Tg=rn,Ag=128,Zo=127;function rn(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw rn.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&Zo)<<s:(o&Zo)*Math.pow(2,s),s+=7}while(o>=Ag);return rn.bytes=n-i,r}var Pg=Math.pow(2,7),Ng=Math.pow(2,14),Rg=Math.pow(2,21),Cg=Math.pow(2,28),Lg=Math.pow(2,35),Bg=Math.pow(2,42),Ug=Math.pow(2,49),kg=Math.pow(2,56),Mg=Math.pow(2,63),jg=function(t){return t<Pg?1:t<Ng?2:t<Rg?3:t<Cg?4:t<Lg?5:t<Bg?6:t<Ug?7:t<kg?8:t<Mg?9:10},qg={encode:Og,decode:Tg,encodingLength:jg},Il=qg;const Xo=(t,e,r=0)=>(Il.encode(t,e,r),e),Qo=t=>Il.encodingLength(t),sn=(t,e)=>{const r=e.byteLength,i=Qo(t),s=i+Qo(r),n=new Uint8Array(s+r);return Xo(t,n,0),Xo(r,n,i),n.set(e,s),new zg(t,r,e,n)};let zg=class{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}};const Dl=({name:t,code:e,encode:r})=>new Fg(t,e,r);let Fg=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?sn(this.code,r):r.then(i=>sn(this.code,i))}else throw Error("Unknown type, must be binary type")}};const Sl=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Kg=Dl({name:"sha2-256",code:18,encode:Sl("SHA-256")}),Vg=Dl({name:"sha2-512",code:19,encode:Sl("SHA-512")});var Hg=Object.freeze({__proto__:null,sha256:Kg,sha512:Vg});const Ol=0,Wg="identity",$l=bl,Gg=t=>sn(Ol,$l(t)),Yg={code:Ol,name:Wg,encode:$l,digest:Gg};var Jg=Object.freeze({__proto__:null,identity:Yg});new TextEncoder,new TextDecoder;const ea={...Ff,...Vf,...Wf,...Yf,...Xf,...cg,...hg,...fg,...bg,...Sg};({...Hg,...Jg});function xl(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ta=xl("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),As=xl("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=wl(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Tl={utf8:ta,"utf-8":ta,hex:ea.base16,latin1:As,ascii:As,binary:As,...ea};function is(t,e="utf8"){const r=Tl[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Or(t,e="utf8"){const r=Tl[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Hn(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function ra(t){return mr(is(Or(t,ts),gl))}function Vi(t){return is(Or(Yt(t),gl),ts)}function Al(t){const e=Or(Tf,Yo),r=xf+is(ml([e,t]),Yo);return[Of,$f,r].join(Sf)}function Zg(t){return is(t,ts)}function Xg(t){return Or(t,ts)}function Qg(t){return Or([Vi(t.header),Vi(t.payload)].join(Ki),yl)}function ey(t){return[Vi(t.header),Vi(t.payload),Zg(t.signature)].join(Ki)}function nn(t){const e=t.split(Ki),r=ra(e[0]),i=ra(e[1]),s=Xg(e[2]),n=Or(e.slice(0,2).join(Ki),yl);return{header:r,payload:i,signature:s,data:n}}function ia(t=sl(Af)){const e=fl.getPublicKey(t);return{secretKey:ml([t,e]),publicKey:e}}async function ty(t,e,r,i,s=R.fromMiliseconds(Date.now())){const n={alg:If,typ:Df},o=Al(i.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},l=Qg({header:n,payload:c}),u=fl.sign(l,i.secretKey.slice(0,32));return ey({header:n,payload:c,signature:u})}var sa=function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},ry=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),iy=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),sy=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),ny=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),oy=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),ay=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,cy=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,na=3,ly=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",ay]],oa=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function uy(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new oy:typeof navigator<"u"?dy(navigator.userAgent):fy()}function hy(t){return t!==""&&ly.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var n=s.exec(t);return!!n&&[i,n]},!1)}function dy(t){var e=hy(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new ny;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<na&&(s=sa(sa([],s,!0),gy(na-s.length),!0)):s=[];var n=s.join("."),o=py(t),a=cy.exec(t);return a&&a[1]?new sy(r,n,o,a[1]):new ry(r,n,o)}function py(t){for(var e=0,r=oa.length;e<r;e++){var i=oa[e],s=i[0],n=i[1],o=n.exec(t);if(o)return s}return null}function fy(){var t=typeof process<"u"&&process.version;return t?new iy(process.version.slice(1)):null}function gy(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var oe={};Object.defineProperty(oe,"__esModule",{value:!0});oe.getLocalStorage=oe.getLocalStorageOrThrow=oe.getCrypto=oe.getCryptoOrThrow=Pl=oe.getLocation=oe.getLocationOrThrow=Wn=oe.getNavigator=oe.getNavigatorOrThrow=Jt=oe.getDocument=oe.getDocumentOrThrow=oe.getFromWindowOrThrow=oe.getFromWindow=void 0;function sr(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}oe.getFromWindow=sr;function $r(t){const e=sr(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}oe.getFromWindowOrThrow=$r;function yy(){return $r("document")}oe.getDocumentOrThrow=yy;function wy(){return sr("document")}var Jt=oe.getDocument=wy;function my(){return $r("navigator")}oe.getNavigatorOrThrow=my;function by(){return sr("navigator")}var Wn=oe.getNavigator=by;function vy(){return $r("location")}oe.getLocationOrThrow=vy;function Ey(){return sr("location")}var Pl=oe.getLocation=Ey;function _y(){return $r("crypto")}oe.getCryptoOrThrow=_y;function Iy(){return sr("crypto")}oe.getCrypto=Iy;function Dy(){return $r("localStorage")}oe.getLocalStorageOrThrow=Dy;function Sy(){return sr("localStorage")}oe.getLocalStorage=Sy;var Gn={};Object.defineProperty(Gn,"__esModule",{value:!0});var Nl=Gn.getWindowMetadata=void 0;const aa=oe;function Oy(){let t,e;try{t=aa.getDocumentOrThrow(),e=aa.getLocationOrThrow()}catch{return null}function r(){const h=t.getElementsByTagName("link"),d=[];for(let f=0;f<h.length;f++){const p=h[f],g=p.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){const y=p.getAttribute("href");if(y)if(y.toLowerCase().indexOf("https:")===-1&&y.toLowerCase().indexOf("http:")===-1&&y.indexOf("//")!==0){let m=e.protocol+"//"+e.host;if(y.indexOf("/")===0)m+=y;else{const w=e.pathname.split("/");w.pop();const b=w.join("/");m+=b+"/"+y}d.push(m)}else if(y.indexOf("//")===0){const m=e.protocol+y;d.push(m)}else d.push(y)}}return d}function i(...h){const d=t.getElementsByTagName("meta");for(let f=0;f<d.length;f++){const p=d[f],g=["itemprop","property","name"].map(y=>p.getAttribute(y)).filter(y=>y?h.includes(y):!1);if(g.length&&g){const y=p.getAttribute("content");if(y)return y}}return""}function s(){let h=i("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function n(){return i("description","og:description","twitter:description","keywords")}const o=s(),a=n(),c=e.origin,l=r();return{description:a,url:c,icons:l,name:o}}Nl=Gn.getWindowMetadata=Oy;function ei(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function ca(t){return ei(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Rl="2.23.2";let Ur={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${Rl}`};class Zt extends Error{constructor(e,r={}){var a;const i=(()=>{var c;return r.cause instanceof Zt?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),s=r.cause instanceof Zt&&r.cause.docsPath||r.docsPath,n=(a=Ur.getDocsUrl)==null?void 0:a.call(Ur,{...r,docsPath:s}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...i?[`Details: ${i}`]:[],...Ur.version?[`Version: ${Ur.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=Rl}walk(e){return Cl(this,e)}}function Cl(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Cl(t.cause,e):e?null:t}class Ll extends Zt{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function xr(t,{dir:e,size:r=32}={}){return typeof t=="string"?$y(t,{dir:e,size:r}):xy(t,{dir:e,size:r})}function $y(t,{dir:e,size:r=32}={}){if(r===null)return t;const i=t.replace("0x","");if(i.length>r*2)throw new Ll({size:Math.ceil(i.length/2),targetSize:r,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function xy(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Ll({size:t.length,targetSize:r,type:"bytes"});const i=new Uint8Array(r);for(let s=0;s<r;s++){const n=e==="right";i[n?s:r-s-1]=t[n?s:t.length-s-1]}return i}class Ty extends Zt{constructor({max:e,min:r,signed:i,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}class Ay extends Zt{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Tr(t,{size:e}){if(ca(t)>e)throw new Ay({givenSize:ca(t),maxSize:e})}function on(t,e={}){const{signed:r}=e;e.size&&Tr(t,{size:e.size});const i=BigInt(t);if(!r)return i;const s=(t.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function Py(t,e={}){return Number(on(t,e))}const Ny=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function an(t,e={}){return typeof t=="number"||typeof t=="bigint"?Ul(t,e):typeof t=="string"?Ly(t,e):typeof t=="boolean"?Ry(t,e):Bl(t,e)}function Ry(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(Tr(r,{size:e.size}),xr(r,{size:e.size})):r}function Bl(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=Ny[t[s]];const i=`0x${r}`;return typeof e.size=="number"?(Tr(i,{size:e.size}),xr(i,{dir:"right",size:e.size})):i}function Ul(t,e={}){const{signed:r,size:i}=e,s=BigInt(t);let n;i?r?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&r?-n-1n:0;if(n&&s>n||s<o){const c=typeof t=="bigint"?"n":"";throw new Ty({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:r,size:i,value:`${t}${c}`})}const a=`0x${(r&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?xr(a,{size:i}):a}const Cy=new TextEncoder;function Ly(t,e={}){const r=Cy.encode(t);return Bl(r,e)}const By=new TextEncoder;function Uy(t,e={}){return typeof t=="number"||typeof t=="bigint"?My(t,e):typeof t=="boolean"?ky(t,e):ei(t)?kl(t,e):Ml(t,e)}function ky(t,e={}){const r=new Uint8Array(1);return r[0]=Number(t),typeof e.size=="number"?(Tr(r,{size:e.size}),xr(r,{size:e.size})):r}const wt={zero:48,nine:57,A:65,F:70,a:97,f:102};function la(t){if(t>=wt.zero&&t<=wt.nine)return t-wt.zero;if(t>=wt.A&&t<=wt.F)return t-(wt.A-10);if(t>=wt.a&&t<=wt.f)return t-(wt.a-10)}function kl(t,e={}){let r=t;e.size&&(Tr(r,{size:e.size}),r=xr(r,{dir:"right",size:e.size}));let i=r.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,n=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=la(i.charCodeAt(a++)),l=la(i.charCodeAt(a++));if(c===void 0||l===void 0)throw new Zt(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);n[o]=c*16+l}return n}function My(t,e){const r=Ul(t,e);return kl(r)}function Ml(t,e={}){const r=By.encode(t);return typeof e.size=="number"?(Tr(r,{size:e.size}),xr(r,{dir:"right",size:e.size})):r}function Hi(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function jy(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ss(t,...e){if(!jy(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function VI(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Hi(t.outputLen),Hi(t.blockLen)}function ua(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function qy(t,e){ss(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Oi=BigInt(2**32-1),ha=BigInt(32);function zy(t,e=!1){return e?{h:Number(t&Oi),l:Number(t>>ha&Oi)}:{h:Number(t>>ha&Oi)|0,l:Number(t&Oi)|0}}function Fy(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=zy(t[s],e);[r[s],i[s]]=[n,o]}return[r,i]}const Ky=(t,e,r)=>t<<r|e>>>32-r,Vy=(t,e,r)=>e<<r|t>>>32-r,Hy=(t,e,r)=>e<<r-32|t>>>64-r,Wy=(t,e,r)=>t<<r-32|e>>>64-r,hr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Gy(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function HI(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function WI(t,e){return t<<32-e|t>>>e}const da=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Yy(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function pa(t){for(let e=0;e<t.length;e++)t[e]=Yy(t[e])}function Jy(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function jl(t){return typeof t=="string"&&(t=Jy(t)),ss(t),t}function GI(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];ss(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class Zy{clone(){return this._cloneInto()}}function Xy(t){const e=i=>t().update(jl(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function YI(t=32){if(hr&&typeof hr.getRandomValues=="function")return hr.getRandomValues(new Uint8Array(t));if(hr&&typeof hr.randomBytes=="function")return hr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const ql=[],zl=[],Fl=[],Qy=BigInt(0),kr=BigInt(1),ew=BigInt(2),tw=BigInt(7),rw=BigInt(256),iw=BigInt(113);for(let t=0,e=kr,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],ql.push(2*(5*i+r)),zl.push((t+1)*(t+2)/2%64);let s=Qy;for(let n=0;n<7;n++)e=(e<<kr^(e>>tw)*iw)%rw,e&ew&&(s^=kr<<(kr<<BigInt(n))-kr);Fl.push(s)}const[sw,nw]=Fy(Fl,!0),fa=(t,e,r)=>r>32?Hy(t,e,r):Ky(t,e,r),ga=(t,e,r)=>r>32?Wy(t,e,r):Vy(t,e,r);function ow(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=fa(l,u,1)^r[a],d=ga(l,u,1)^r[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=zl[o],c=fa(s,n,a),l=ga(s,n,a),u=ql[o];s=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=sw[i],t[1]^=nw[i]}r.fill(0)}class Yn extends Zy{constructor(e,r,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Hi(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Gy(this.state)}keccak(){da||pa(this.state32),ow(this.state32,this.rounds),da||pa(this.state32),this.posOut=0,this.pos=0}update(e){ua(this);const{blockLen:r,state:i}=this;e=jl(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,r&128&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){ua(this,!1),ss(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Hi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(qy(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new Yn(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const aw=(t,e,r)=>Xy(()=>new Yn(e,t,r)),cw=aw(1,136,256/8);function Kl(t,e){const r=e||"hex",i=cw(ei(t,{strict:!1})?Uy(t):t);return r==="bytes"?i:an(i)}class lw extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Ps=new lw(8192);function uw(t,e){if(Ps.has(`${t}.${e}`))return Ps.get(`${t}.${e}`);const r=t.substring(2).toLowerCase(),i=Kl(Ml(r),"bytes"),s=r.split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(i[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const n=`0x${s.join("")}`;return Ps.set(`${t}.${e}`,n),n}function hw(t){const e=Kl(`0x${t.substring(4)}`).substring(26);return uw(`0x${e}`)}async function dw({hash:t,signature:e}){const r=ei(t)?t:an(t),{secp256k1:i}=await yh(async()=>{const{secp256k1:o}=await import("./secp256k1-Cez8NuvW.js");return{secp256k1:o}},__vite__mapDeps([0,1,2,3]),import.meta.url);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:u,v:h,yParity:d}=e,f=Number(d??h),p=ya(f);return new i.Signature(on(l),on(u)).addRecoveryBit(p)}const o=ei(e)?e:an(e),a=Py(`0x${o.slice(130)}`),c=ya(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function ya(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function pw({hash:t,signature:e}){return hw(await dw({hash:t,signature:e}))}function fw(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const r=t.length,i=t.charAt(0),s=Math.log(r)/Math.log(256),n=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,d=0;const f=l.length;for(;d!==f&&l[d]===0;)d++,u++;const p=(f-d)*n+1>>>0,g=new Uint8Array(p);for(;d!==f;){let w=l[d],b=0;for(let E=p-1;(w!==0||b<h)&&E!==-1;E--,b++)w+=256*g[E]>>>0,g[E]=w%r>>>0,w=w/r>>>0;if(w!==0)throw new Error("Non-zero carry");h=b,d++}let y=p-h;for(;y!==p&&g[y]===0;)y++;let m=i.repeat(u);for(;y<p;++y)m+=t.charAt(g[y]);return m}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,d=0;for(;l[u]===i;)h++,u++;const f=(l.length-u)*s+1>>>0,p=new Uint8Array(f);for(;u<l.length;){const w=l.charCodeAt(u);if(w>255)return;let b=e[w];if(b===255)return;let E=0;for(let O=f-1;(b!==0||E<d)&&O!==-1;O--,E++)b+=r*p[O]>>>0,p[O]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");d=E,u++}let g=f-d;for(;g!==f&&p[g]===0;)g++;const y=new Uint8Array(h+(f-g));let m=h;for(;g!==f;)y[m++]=p[g++];return y}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var gw="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const yw=fw(gw);function Vl(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Wr(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=Vl(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return r}function ww(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,m=0,w=p.length;m!==w&&p[m]===0;)m++,g++;for(var b=(w-m)*u+1>>>0,E=new Uint8Array(b);m!==w;){for(var O=p[m],$=0,S=b-1;(O!==0||$<y)&&S!==-1;S--,$++)O+=256*E[S]>>>0,E[S]=O%a>>>0,O=O/a>>>0;if(O!==0)throw new Error("Non-zero carry");y=$,m++}for(var T=b-y;T!==b&&E[T]===0;)T++;for(var I=c.repeat(g);T<b;++T)I+=t.charAt(E[T]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,m=0;p[g]===c;)y++,g++;for(var w=(p.length-g)*l+1>>>0,b=new Uint8Array(w);p[g];){var E=r[p.charCodeAt(g)];if(E===255)return;for(var O=0,$=w-1;(E!==0||O<m)&&$!==-1;$--,O++)E+=a*b[$]>>>0,b[$]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=O,g++}if(p[g]!==" "){for(var S=w-m;S!==w&&b[S]===0;)S++;for(var T=new Uint8Array(y+(w-S)),I=y;S!==w;)T[I++]=b[S++];return T}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var mw=ww,bw=mw;const vw=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Ew=t=>new TextEncoder().encode(t),_w=t=>new TextDecoder().decode(t);class Iw{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Dw{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Hl(this,e)}}class Sw{constructor(e){this.decoders=e}or(e){return Hl(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Hl=(t,e)=>new Sw({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Ow{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Iw(e,r,i),this.decoder=new Dw(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ns=({name:t,prefix:e,encode:r,decode:i})=>new Ow(t,e,r,i),ui=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=bw(r,e);return ns({prefix:t,name:e,encode:i,decode:n=>vw(s(n))})},$w=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},xw=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},$e=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ns({prefix:e,name:t,encode(s){return xw(s,i,r)},decode(s){return $w(s,i,r,t)}}),Tw=ns({prefix:"\0",name:"identity",encode:t=>_w(t),decode:t=>Ew(t)}),Aw=Object.freeze(Object.defineProperty({__proto__:null,identity:Tw},Symbol.toStringTag,{value:"Module"})),Pw=$e({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Nw=Object.freeze(Object.defineProperty({__proto__:null,base2:Pw},Symbol.toStringTag,{value:"Module"})),Rw=$e({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Cw=Object.freeze(Object.defineProperty({__proto__:null,base8:Rw},Symbol.toStringTag,{value:"Module"})),Lw=ui({prefix:"9",name:"base10",alphabet:"0123456789"}),Bw=Object.freeze(Object.defineProperty({__proto__:null,base10:Lw},Symbol.toStringTag,{value:"Module"})),Uw=$e({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),kw=$e({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Mw=Object.freeze(Object.defineProperty({__proto__:null,base16:Uw,base16upper:kw},Symbol.toStringTag,{value:"Module"})),jw=$e({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qw=$e({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),zw=$e({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Fw=$e({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Kw=$e({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Vw=$e({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Hw=$e({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ww=$e({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Gw=$e({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Yw=Object.freeze(Object.defineProperty({__proto__:null,base32:jw,base32hex:Kw,base32hexpad:Hw,base32hexpadupper:Ww,base32hexupper:Vw,base32pad:zw,base32padupper:Fw,base32upper:qw,base32z:Gw},Symbol.toStringTag,{value:"Module"})),Jw=ui({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Zw=ui({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Xw=Object.freeze(Object.defineProperty({__proto__:null,base36:Jw,base36upper:Zw},Symbol.toStringTag,{value:"Module"})),Qw=ui({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),em=ui({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),tm=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Qw,base58flickr:em},Symbol.toStringTag,{value:"Module"})),rm=$e({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),im=$e({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),sm=$e({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),nm=$e({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),om=Object.freeze(Object.defineProperty({__proto__:null,base64:rm,base64pad:im,base64url:sm,base64urlpad:nm},Symbol.toStringTag,{value:"Module"})),Wl=Array.from(""),am=Wl.reduce((t,e,r)=>(t[r]=e,t),[]),cm=Wl.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function lm(t){return t.reduce((e,r)=>(e+=am[r],e),"")}function um(t){const e=[];for(const r of t){const i=cm[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const hm=ns({prefix:"",name:"base256emoji",encode:lm,decode:um}),dm=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:hm},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const wa={...Aw,...Nw,...Cw,...Bw,...Mw,...Yw,...Xw,...tm,...om,...dm};function Gl(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ma=Gl("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ns=Gl("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Vl(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Yl={utf8:ma,"utf-8":ma,hex:wa.base16,latin1:Ns,ascii:Ns,binary:Ns,...wa};function Xe(t,e="utf8"){const r=Yl[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function je(t,e="utf8"){const r=Yl[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const pm={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Dt=["buffer","Buffer"],fm={};const gm=":";function Bi(t){const[e,r]=t.split(gm);return{namespace:e,reference:r}}function Jl(t,e){return t.includes(":")?[t]:e.chains||[]}var ym=Object.defineProperty,wm=Object.defineProperties,mm=Object.getOwnPropertyDescriptors,ba=Object.getOwnPropertySymbols,bm=Object.prototype.hasOwnProperty,vm=Object.prototype.propertyIsEnumerable,va=(t,e,r)=>e in t?ym(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ea=(t,e)=>{for(var r in e||(e={}))bm.call(e,r)&&va(t,r,e[r]);if(ba)for(var r of ba(e))vm.call(e,r)&&va(t,r,e[r]);return t},Em=(t,e)=>wm(t,mm(e));const _m="ReactNative",He={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Im="js";function Wi(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ct(){return!Jt()&&!!Wn()&&navigator.product===_m}function Dm(){return Ct()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="android"}function Sm(){return Ct()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="ios"}function Ar(){return!Wi()&&!!Wn()&&!!Jt()}function hi(){return Ct()?He.reactNative:Wi()?He.node:Ar()?He.browser:He.unknown}function _a(){var t;try{return Ct()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Application)<"u"?(t=globalThis.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Om(t,e){const r=new URLSearchParams(t);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];s!==void 0&&r.set(i,s)}return r.toString()}function $m(t){var e,r;const i=Zl();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),Em(Ea(Ea({},i),t),{url:(t==null?void 0:t.url)||i.url,name:(t==null?void 0:t.name)||i.name,description:(t==null?void 0:t.description)||i.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),t||i}}function Zl(){return Nl()||{name:"",description:"",url:"",icons:[""]}}function xm(){if(hi()===He.reactNative&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"){const{OS:r,Version:i}=globalThis.Platform;return[r,i].join("-")}const t=uy();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Tm(){var t;const e=hi();return e===He.browser?[e,((t=Pl())==null?void 0:t.host)||"unknown"].join(":"):e}function Xl(t,e,r){const i=xm(),s=Tm();return[[t,e].join("-"),[Im,r].join("-"),i,s].join("/")}function Am({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=Xl(t,e,i),h={auth:s,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=Om(l[1]||"",h);return l[0]+"?"+d}function Ht(t,e){return t.filter(r=>e.includes(r)).length===t.length}function cn(t){return Object.fromEntries(t.entries())}function ln(t){return new Map(Object.entries(t))}function Mt(t=R.FIVE_MINUTES,e){const r=R.toMiliseconds(t||R.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),i=a,s=c})}}function Nt(t,e,r){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(r)),e);try{const o=await t;i(o)}catch(o){s(o)}clearTimeout(n)})}function Ql(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Pm(t){return Ql("topic",t)}function Nm(t){return Ql("id",t)}function eu(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function pe(t,e){return R.fromMiliseconds(Date.now()+R.toMiliseconds(t))}function At(t){return Date.now()>=R.toMiliseconds(t)}function X(t,e){return`${t}${e?`:${e}`:""}`}function Wt(t=[],e=[]){return[...new Set([...t,...e])]}async function Rm({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,n=s==null?void 0:s.href;if(typeof n!="string")return;const o=Cm(n,t,e),a=hi();if(a===He.browser){if(!((i=Jt())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Lm(o)}else a===He.reactNative&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"&&await globalThis.Linking.openURL(o)}catch(s){console.error(s)}}function Cm(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${Mm(i,!0)}`}else s=`${s}/wc?${i}`;return s}function Lm(t){let e="_self";km()?e="_top":(Um()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function Bm(t,e){let r="";try{if(Ar()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function Ia(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function Da(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Jn(){return typeof process<"u"&&fm.IS_VITEST==="true"}function Um(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function km(){try{return window.self!==window.top}catch{return!1}}function Mm(t,e=!1){const r=Dt.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function tu(t){return Dt.from(t,"base64").toString("utf-8")}function jm(t){return new Promise(e=>setTimeout(e,t))}function ti(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function qm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function di(t,...e){if(!qm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Zn(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ti(t.outputLen),ti(t.blockLen)}function br(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ru(t,e){di(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const $i=BigInt(2**32-1),Sa=BigInt(32);function zm(t,e=!1){return e?{h:Number(t&$i),l:Number(t>>Sa&$i)}:{h:Number(t>>Sa&$i)|0,l:Number(t&$i)|0}}function Fm(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=zm(t[s],e);[r[s],i[s]]=[n,o]}return[r,i]}const Km=(t,e,r)=>t<<r|e>>>32-r,Vm=(t,e,r)=>e<<r|t>>>32-r,Hm=(t,e,r)=>e<<r-32|t>>>64-r,Wm=(t,e,r)=>t<<r-32|e>>>64-r,dr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Gm(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Rs(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ct(t,e){return t<<32-e|t>>>e}const Oa=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ym(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function $a(t){for(let e=0;e<t.length;e++)t[e]=Ym(t[e])}function Jm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function vr(t){return typeof t=="string"&&(t=Jm(t)),di(t),t}function Zm(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];di(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}let Xn=class{clone(){return this._cloneInto()}};function iu(t){const e=i=>t().update(vr(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Pr(t=32){if(dr&&typeof dr.getRandomValues=="function")return dr.getRandomValues(new Uint8Array(t));if(dr&&typeof dr.randomBytes=="function")return dr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const su=[],nu=[],ou=[],Xm=BigInt(0),Mr=BigInt(1),Qm=BigInt(2),eb=BigInt(7),tb=BigInt(256),rb=BigInt(113);for(let t=0,e=Mr,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],su.push(2*(5*i+r)),nu.push((t+1)*(t+2)/2%64);let s=Xm;for(let n=0;n<7;n++)e=(e<<Mr^(e>>eb)*rb)%tb,e&Qm&&(s^=Mr<<(Mr<<BigInt(n))-Mr);ou.push(s)}const[ib,sb]=Fm(ou,!0),xa=(t,e,r)=>r>32?Hm(t,e,r):Km(t,e,r),Ta=(t,e,r)=>r>32?Wm(t,e,r):Vm(t,e,r);function nb(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=xa(l,u,1)^r[a],d=Ta(l,u,1)^r[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=nu[o],c=xa(s,n,a),l=Ta(s,n,a),u=su[o];s=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=ib[i],t[1]^=sb[i]}r.fill(0)}let ob=class au extends Xn{constructor(e,r,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ti(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Gm(this.state)}keccak(){Oa||$a(this.state32),nb(this.state32,this.rounds),Oa||$a(this.state32),this.posOut=0,this.pos=0}update(e){br(this);const{blockLen:r,state:i}=this;e=vr(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,r&128&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){br(this,!1),di(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ti(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ru(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new au(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const ab=(t,e,r)=>iu(()=>new ob(e,t,r)),cb=ab(1,136,256/8),lb="https://rpc.walletconnect.org/v1";function cu(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Dt.from(cb(r)).toString("hex")}async function ub(t,e,r,i,s,n){switch(r.t){case"eip191":return await hb(t,e,r.s);case"eip1271":return await db(t,e,r.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function hb(t,e,r){return(await pw({hash:cu(e),signature:r})).toLowerCase()===t.toLowerCase()}async function db(t,e,r,i,s,n){const o=Bi(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l="0000000000000000000000000000000000000000000000000000000000000041",u=r.substring(2),h=cu(e).substring(2),d=a+h+c+l+u,f=await fetch(`${n||lb}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:pb(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function pb(){return Date.now()+Math.floor(Math.random()*1e3)}function fb(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const n=Dt.from(t,"base64").slice(1,65);return yw.encode(n)}var gb=Object.defineProperty,yb=Object.defineProperties,wb=Object.getOwnPropertyDescriptors,Aa=Object.getOwnPropertySymbols,mb=Object.prototype.hasOwnProperty,bb=Object.prototype.propertyIsEnumerable,Pa=(t,e,r)=>e in t?gb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vb=(t,e)=>{for(var r in e||(e={}))mb.call(e,r)&&Pa(t,r,e[r]);if(Aa)for(var r of Aa(e))bb.call(e,r)&&Pa(t,r,e[r]);return t},Eb=(t,e)=>yb(t,wb(e));const _b="did:pkh:",Qn=t=>t==null?void 0:t.split(":"),Ib=t=>{const e=t&&Qn(t);if(e)return t.includes(_b)?e[3]:e[1]},un=t=>{const e=t&&Qn(t);if(e)return e[2]+":"+e[3]},Gi=t=>{const e=t&&Qn(t);if(e)return e.pop()};async function Na(t){const{cacao:e,projectId:r}=t,{s:i,p:s}=e,n=lu(s,s.iss),o=Gi(s.iss);return await ub(o,n,i,un(s.iss),r)}const lu=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,i=Gi(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${Ib(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,f=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=Ui(t.resources);if(p){const g=ri(p);s=Nb(s,g)}return[r,i,"",s,"",n,o,a,c,l,u,h,d,f].filter(g=>g!=null).join(`
`)};function Db(t){return Dt.from(JSON.stringify(t)).toString("base64")}function Sb(t){return JSON.parse(Dt.from(t,"base64").toString("utf-8"))}function Xt(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function Ob(t,e,r,i={}){return r==null||r.sort((s,n)=>s.localeCompare(n)),{att:{[t]:$b(e,r,i)}}}function $b(t,e,r={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...i)}function uu(t){return Xt(t),`urn:recap:${Db(t).replace(/=/g,"")}`}function ri(t){const e=Sb(t.replace("urn:recap:",""));return Xt(e),e}function xb(t,e,r){const i=Ob(t,e,r);return uu(i)}function Tb(t){return t&&t.includes("urn:recap:")}function Ab(t,e){const r=ri(t),i=ri(e),s=Pb(r,i);return uu(s)}function Pb(t,e){Xt(t),Xt(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return r.forEach(s=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[s]=Eb(vb({},i.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),i}function Nb(t="",e){Xt(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(s++,`(${s}) '${h}': '${l[h].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const n=i.join(" "),o=`${r}${n}`;return`${t?t+" ":""}${o}`}function Ra(t){var e;const r=ri(t);Xt(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function Ca(t){const e=ri(t);Xt(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function Ui(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return Tb(e)?e:void 0}function Cs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function hu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ve(t,...e){if(!hu(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function La(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Rb(t,e){Ve(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ba(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const Rt=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Cb=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Lb=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Lb)throw new Error("Non little-endian hardware is not supported");function Bb(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function hn(t){if(typeof t=="string")t=Bb(t);else if(hu(t))t=dn(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Ub(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function kb(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const Mb=(t,e)=>{function r(i,...s){if(Ve(i),t.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Ve(l):Ve(l,t.nonceLength)}const n=t.tagLength;n&&s[1]!==void 0&&Ve(s[1]);const o=e(i,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Ve(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ve(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Ve(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function Ua(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!jb(e))throw new Error("invalid output, must be aligned");return e}function ka(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function jb(t){return t.byteOffset%4===0}function dn(t){return Uint8Array.from(t)}function Er(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const du=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),qb=du("expand 16-byte k"),zb=du("expand 32-byte k"),Fb=Rt(qb),Kb=Rt(zb);function J(t,e){return t<<e|t>>>32-e}function pn(t){return t.byteOffset%4===0}const xi=64,Vb=16,pu=2**32-1,Ma=new Uint32Array;function Hb(t,e,r,i,s,n,o,a){const c=s.length,l=new Uint8Array(xi),u=Rt(l),h=pn(s)&&pn(n),d=h?Rt(s):Ma,f=h?Rt(n):Ma;for(let p=0;p<c;o++){if(t(e,r,i,u,o,a),o>=pu)throw new Error("arx: counter overflow");const g=Math.min(xi,c-p);if(h&&g===xi){const y=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let m=0,w;m<Vb;m++)w=y+m,f[w]=d[w]^u[m];p+=xi;continue}for(let y=0,m;y<g;y++)m=p+y,n[m]=s[m]^l[y];p+=g}}function Wb(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=Ub({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Cs(s),Cs(o),Ba(n),Ba(r),(a,c,l,u,h=0)=>{Ve(a),Ve(c),Ve(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),Ve(u),Cs(h),h<0||h>=pu)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const f=[];let p=a.length,g,y;if(p===32)f.push(g=dn(a)),y=Kb;else if(p===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),y=Fb,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);pn(c)||f.push(c=dn(c));const m=Rt(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(y,m,Rt(c.subarray(0,16)),m),c=c.subarray(16)}const w=16-s;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const E=new Uint8Array(12);E.set(c,n?0:12-c.length),c=E,f.push(c)}const b=Rt(c);return Hb(t,y,m,b,l,u,h,o),Er(...f),u}}const _e=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class Gb{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=hn(e),Ve(e,32);const r=_e(e,0),i=_e(e,2),s=_e(e,4),n=_e(e,6),o=_e(e,8),a=_e(e,10),c=_e(e,12),l=_e(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=_e(e,16+2*u)}process(e,r,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],f=o[6],p=o[7],g=o[8],y=o[9],m=_e(e,r+0),w=_e(e,r+2),b=_e(e,r+4),E=_e(e,r+6),O=_e(e,r+8),$=_e(e,r+10),S=_e(e,r+12),T=_e(e,r+14);let I=n[0]+(m&8191),j=n[1]+((m>>>13|w<<3)&8191),B=n[2]+((w>>>10|b<<6)&8191),k=n[3]+((b>>>7|E<<9)&8191),q=n[4]+((E>>>4|O<<12)&8191),P=n[5]+(O>>>1&8191),_=n[6]+((O>>>14|$<<2)&8191),v=n[7]+(($>>>11|S<<5)&8191),x=n[8]+((S>>>8|T<<8)&8191),A=n[9]+(T>>>5|s),D=0,C=D+I*a+j*(5*y)+B*(5*g)+k*(5*p)+q*(5*f);D=C>>>13,C&=8191,C+=P*(5*d)+_*(5*h)+v*(5*u)+x*(5*l)+A*(5*c),D+=C>>>13,C&=8191;let U=D+I*c+j*a+B*(5*y)+k*(5*g)+q*(5*p);D=U>>>13,U&=8191,U+=P*(5*f)+_*(5*d)+v*(5*h)+x*(5*u)+A*(5*l),D+=U>>>13,U&=8191;let M=D+I*l+j*c+B*a+k*(5*y)+q*(5*g);D=M>>>13,M&=8191,M+=P*(5*p)+_*(5*f)+v*(5*d)+x*(5*h)+A*(5*u),D+=M>>>13,M&=8191;let z=D+I*u+j*l+B*c+k*a+q*(5*y);D=z>>>13,z&=8191,z+=P*(5*g)+_*(5*p)+v*(5*f)+x*(5*d)+A*(5*h),D+=z>>>13,z&=8191;let F=D+I*h+j*u+B*l+k*c+q*a;D=F>>>13,F&=8191,F+=P*(5*y)+_*(5*g)+v*(5*p)+x*(5*f)+A*(5*d),D+=F>>>13,F&=8191;let V=D+I*d+j*h+B*u+k*l+q*c;D=V>>>13,V&=8191,V+=P*a+_*(5*y)+v*(5*g)+x*(5*p)+A*(5*f),D+=V>>>13,V&=8191;let G=D+I*f+j*d+B*h+k*u+q*l;D=G>>>13,G&=8191,G+=P*c+_*a+v*(5*y)+x*(5*g)+A*(5*p),D+=G>>>13,G&=8191;let ie=D+I*p+j*f+B*d+k*h+q*u;D=ie>>>13,ie&=8191,ie+=P*l+_*c+v*a+x*(5*y)+A*(5*g),D+=ie>>>13,ie&=8191;let Q=D+I*g+j*p+B*f+k*d+q*h;D=Q>>>13,Q&=8191,Q+=P*u+_*l+v*c+x*a+A*(5*y),D+=Q>>>13,Q&=8191;let Y=D+I*y+j*g+B*p+k*f+q*d;D=Y>>>13,Y&=8191,Y+=P*h+_*u+v*l+x*c+A*a,D+=Y>>>13,Y&=8191,D=(D<<2)+D|0,D=D+C|0,C=D&8191,D=D>>>13,U+=D,n[0]=C,n[1]=U,n[2]=M,n[3]=z,n[4]=F,n[5]=V,n[6]=G,n[7]=ie,n[8]=Q,n[9]=Y}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Er(i)}update(e){La(this);const{buffer:r,blockLen:i}=this;e=hn(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}r.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Er(this.h,this.r,this.buffer,this.pad)}digestInto(e){La(this),Rb(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function Yb(t){const e=(i,s)=>t(s).update(hn(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const Jb=Yb(t=>new Gb(t));function Zb(t,e,r,i,s,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],f=e[3],p=e[4],g=e[5],y=e[6],m=e[7],w=s,b=r[0],E=r[1],O=r[2],$=o,S=a,T=c,I=l,j=u,B=h,k=d,q=f,P=p,_=g,v=y,x=m,A=w,D=b,C=E,U=O;for(let z=0;z<n;z+=2)$=$+j|0,A=J(A^$,16),P=P+A|0,j=J(j^P,12),$=$+j|0,A=J(A^$,8),P=P+A|0,j=J(j^P,7),S=S+B|0,D=J(D^S,16),_=_+D|0,B=J(B^_,12),S=S+B|0,D=J(D^S,8),_=_+D|0,B=J(B^_,7),T=T+k|0,C=J(C^T,16),v=v+C|0,k=J(k^v,12),T=T+k|0,C=J(C^T,8),v=v+C|0,k=J(k^v,7),I=I+q|0,U=J(U^I,16),x=x+U|0,q=J(q^x,12),I=I+q|0,U=J(U^I,8),x=x+U|0,q=J(q^x,7),$=$+B|0,U=J(U^$,16),v=v+U|0,B=J(B^v,12),$=$+B|0,U=J(U^$,8),v=v+U|0,B=J(B^v,7),S=S+k|0,A=J(A^S,16),x=x+A|0,k=J(k^x,12),S=S+k|0,A=J(A^S,8),x=x+A|0,k=J(k^x,7),T=T+q|0,D=J(D^T,16),P=P+D|0,q=J(q^P,12),T=T+q|0,D=J(D^T,8),P=P+D|0,q=J(q^P,7),I=I+j|0,C=J(C^I,16),_=_+C|0,j=J(j^_,12),I=I+j|0,C=J(C^I,8),_=_+C|0,j=J(j^_,7);let M=0;i[M++]=o+$|0,i[M++]=a+S|0,i[M++]=c+T|0,i[M++]=l+I|0,i[M++]=u+j|0,i[M++]=h+B|0,i[M++]=d+k|0,i[M++]=f+q|0,i[M++]=p+P|0,i[M++]=g+_|0,i[M++]=y+v|0,i[M++]=m+x|0,i[M++]=w+A|0,i[M++]=b+D|0,i[M++]=E+C|0,i[M++]=O+U|0}const Xb=Wb(Zb,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Qb=new Uint8Array(16),ja=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(Qb.subarray(r))},e0=new Uint8Array(32);function qa(t,e,r,i,s){const n=t(e,r,e0),o=Jb.create(n);s&&ja(o,s),ja(o,i);const a=new Uint8Array(16),c=Cb(a);ka(c,0,BigInt(s?s.length:0),!0),ka(c,8,BigInt(i.length),!0),o.update(a);const l=o.digest();return Er(n,a),l}const t0=t=>(e,r,i)=>({encrypt(s,n){const o=s.length;n=Ua(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);t(e,r,a,a,1);const c=qa(t,e,r,a,i);return n.set(c,o),Er(c),n},decrypt(s,n){n=Ua(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=qa(t,e,r,o,i);if(!kb(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),t(e,r,n,n,1),Er(c),n}}),fu=Mb({blockSize:64,nonceLength:12,tagLength:16},t0(Xb));let gu=class extends Xn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Zn(e);const i=vr(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return br(this),this.iHash.update(e),this}digestInto(e){br(this),di(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const os=(t,e,r)=>new gu(t,e).update(r).digest();os.create=(t,e)=>new gu(t,e);function r0(t,e,r){return Zn(t),r===void 0&&(r=new Uint8Array(t.outputLen)),os(t,vr(r),vr(e))}const Ls=new Uint8Array([0]),za=new Uint8Array;function i0(t,e,r,i=32){if(Zn(t),ti(i),i>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/t.outputLen);r===void 0&&(r=za);const n=new Uint8Array(s*t.outputLen),o=os.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<s;l++)Ls[0]=l+1,a.update(l===0?za:c).update(r).update(Ls).digestInto(c),n.set(c,t.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Ls.fill(0),n.slice(0,i)}const s0=(t,e,r,i,s)=>i0(t,r0(t,e,r),i,s);function n0(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function o0(t,e,r){return t&e^~t&r}function a0(t,e,r){return t&e^t&r^e&r}let c0=class extends Xn{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Rs(this.buffer)}update(e){br(this);const{view:r,buffer:i,blockLen:s}=this;e=vr(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Rs(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){br(this),ru(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;n0(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Rs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%r&&e.buffer.set(i),e}};const l0=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Tt=new Uint32Array(64);class u0 extends c0{constructor(){super(64,32,8,!1),this.A=xt[0]|0,this.B=xt[1]|0,this.C=xt[2]|0,this.D=xt[3]|0,this.E=xt[4]|0,this.F=xt[5]|0,this.G=xt[6]|0,this.H=xt[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Tt[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=Tt[h-15],f=Tt[h-2],p=ct(d,7)^ct(d,18)^d>>>3,g=ct(f,17)^ct(f,19)^f>>>10;Tt[h]=g+Tt[h-7]+p+Tt[h-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=ct(a,6)^ct(a,11)^ct(a,25),f=u+d+o0(a,c,l)+l0[h]+Tt[h]|0,p=(ct(i,2)^ct(i,13)^ct(i,22))+a0(i,s,n)|0;u=l,l=c,c=a,a=o+f|0,o=n,n=s,s=i,i=f+p|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,s,n,o,a,c,l,u)}roundClean(){Tt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const pi=iu(()=>new u0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const as=BigInt(0),cs=BigInt(1),h0=BigInt(2);function Qt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function fi(t){if(!Qt(t))throw new Error("Uint8Array expected")}function _r(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const d0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ir(t){fi(t);let e="";for(let r=0;r<t.length;r++)e+=d0[t[r]];return e}function yr(t){const e=t.toString(16);return e.length&1?"0"+e:e}function eo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?as:BigInt("0x"+t)}const mt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Fa(t){if(t>=mt._0&&t<=mt._9)return t-mt._0;if(t>=mt.A&&t<=mt.F)return t-(mt.A-10);if(t>=mt.a&&t<=mt.f)return t-(mt.a-10)}function Dr(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Fa(t.charCodeAt(n)),a=Fa(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Gt(t){return eo(Ir(t))}function ii(t){return fi(t),eo(Ir(Uint8Array.from(t).reverse()))}function Sr(t,e){return Dr(t.toString(16).padStart(e*2,"0"))}function ls(t,e){return Sr(t,e).reverse()}function p0(t){return Dr(yr(t))}function Ke(t,e,r){let i;if(typeof e=="string")try{i=Dr(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Qt(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function si(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];fi(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}function f0(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}function g0(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const Bs=t=>typeof t=="bigint"&&as<=t;function us(t,e,r){return Bs(t)&&Bs(e)&&Bs(r)&&e<=t&&t<r}function _t(t,e,r,i){if(!us(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function yu(t){let e;for(e=0;t>as;t>>=cs,e+=1);return e}function y0(t,e){return t>>BigInt(e)&cs}function w0(t,e,r){return t|(r?cs:as)<<BigInt(e)}const to=t=>(h0<<BigInt(t-1))-cs,Us=t=>new Uint8Array(t),Ka=t=>Uint8Array.from(t);function wu(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Us(t),s=Us(t),n=0;const o=()=>{i.fill(1),s.fill(0),n=0},a=(...u)=>r(s,i,...u),c=(u=Us())=>{s=a(Ka([0]),u),i=a(),u.length!==0&&(s=a(Ka([1]),u),i=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const h=[];for(;u<e;){i=a();const d=i.slice();h.push(d),u+=i.length}return si(...h)};return(u,h)=>{o(),c(u);let d;for(;!(d=h(l()));)c();return o(),d}}const m0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Qt(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Nr(t,e,r={}){const i=(s,n,o)=>{const a=m0[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}const b0=()=>{throw new Error("not implemented")};function fn(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}var v0=Object.freeze({__proto__:null,isBytes:Qt,abytes:fi,abool:_r,bytesToHex:Ir,numberToHexUnpadded:yr,hexToNumber:eo,hexToBytes:Dr,bytesToNumberBE:Gt,bytesToNumberLE:ii,numberToBytesBE:Sr,numberToBytesLE:ls,numberToVarBytesBE:p0,ensureBytes:Ke,concatBytes:si,equalBytes:f0,utf8ToBytes:g0,inRange:us,aInRange:_t,bitLen:yu,bitGet:y0,bitSet:w0,bitMask:to,createHmacDrbg:wu,validateObject:Nr,notImplemented:b0,memoized:fn});const ve=BigInt(0),le=BigInt(1),zt=BigInt(2),E0=BigInt(3),gn=BigInt(4),Va=BigInt(5),Ha=BigInt(8);function Me(t,e){const r=t%e;return r>=ve?r:e+r}function mu(t,e,r){if(e<ve)throw new Error("invalid exponent, negatives unsupported");if(r<=ve)throw new Error("invalid modulus");if(r===le)return ve;let i=le;for(;e>ve;)e&le&&(i=i*t%r),t=t*t%r,e>>=le;return i}function it(t,e,r){let i=t;for(;e-- >ve;)i*=i,i%=r;return i}function yn(t,e){if(t===ve)throw new Error("invert: expected non-zero number");if(e<=ve)throw new Error("invert: expected positive modulus, got "+e);let r=Me(t,e),i=e,s=ve,n=le;for(;r!==ve;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==le)throw new Error("invert: does not exist");return Me(s,e)}function _0(t){const e=(t-le)/zt;let r,i,s;for(r=t-le,i=0;r%zt===ve;r/=zt,i++);for(s=zt;s<t&&mu(s,e,t)!==t-le;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+le)/gn;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(r+le)/zt;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,s),r),u=o.pow(a,n),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(h);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(l,le<<BigInt(c-d-1));l=o.sqr(f),u=o.mul(u,f),h=o.mul(h,l),c=d}return u}}function I0(t){if(t%gn===E0){const e=(t+le)/gn;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%Ha===Va){const e=(t-Va)/Ha;return function(r,i){const s=r.mul(i,zt),n=r.pow(s,e),o=r.mul(i,n),a=r.mul(r.mul(o,zt),n),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return _0(t)}const D0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function S0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=D0.reduce((i,s)=>(i[s]="function",i),e);return Nr(t,r)}function O0(t,e,r){if(r<ve)throw new Error("invalid exponent, negatives unsupported");if(r===ve)return t.ONE;if(r===le)return e;let i=t.ONE,s=e;for(;r>ve;)r&le&&(i=t.mul(i,s)),s=t.sqr(s),r>>=le;return i}function $0(t,e){const r=new Array(e.length),i=e.reduce((n,o,a)=>t.is0(o)?n:(r[a]=n,t.mul(n,o)),t.ONE),s=t.inv(i);return e.reduceRight((n,o,a)=>t.is0(o)?n:(r[a]=t.mul(n,r[a]),t.mul(n,o)),s),r}function bu(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function vu(t,e,r=!1,i={}){if(t<=ve)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=bu(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:to(s),ZERO:ve,ONE:le,create:c=>Me(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ve<=c&&c<t},is0:c=>c===ve,isOdd:c=>(c&le)===le,neg:c=>Me(-c,t),eql:(c,l)=>c===l,sqr:c=>Me(c*c,t),add:(c,l)=>Me(c+l,t),sub:(c,l)=>Me(c-l,t),mul:(c,l)=>Me(c*l,t),pow:(c,l)=>O0(a,c,l),div:(c,l)=>Me(c*yn(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>yn(c,t),sqrt:i.sqrt||(c=>(o||(o=I0(t)),o(a,c))),invertBatch:c=>$0(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?ls(c,n):Sr(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?ii(c):Gt(c)}});return Object.freeze(a)}function Eu(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function _u(t){const e=Eu(t);return e+Math.ceil(e/2)}function x0(t,e,r=!1){const i=t.length,s=Eu(e),n=_u(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?ii(t):Gt(t),a=Me(o,e-le)+le;return r?ls(a,s):Sr(a,s)}const Wa=BigInt(0),Ti=BigInt(1);function ks(t,e){const r=e.negate();return t?r:e}function Iu(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ms(t,e){Iu(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function T0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function A0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const js=new WeakMap,Du=new WeakMap;function qs(t){return Du.get(t)||1}function P0(t,e){return{constTimeNegate:ks,hasPrecomputes(r){return qs(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>Wa;)i&Ti&&(s=s.add(n)),n=n.double(),i>>=Ti;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Ms(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){const{windows:n,windowSize:o}=Ms(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let d=0;d<n;d++){const f=d*o;let p=Number(s&l);s>>=h,p>o&&(p-=u,s+=Ti);const g=f,y=f+Math.abs(p)-1,m=d%2!==0,w=p<0;p===0?c=c.add(ks(m,i[g])):a=a.add(ks(w,i[y]))}return{p:a,f:c}},wNAFUnsafe(r,i,s,n=t.ZERO){const{windows:o,windowSize:a}=Ms(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const d=h*a;if(s===Wa)break;let f=Number(s&c);if(s>>=u,f>a&&(f-=l,s+=Ti),f===0)continue;let p=i[d+Math.abs(f)-1];f<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(r,i,s){let n=js.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&js.set(i,s(n))),n},wNAFCached(r,i,s){const n=qs(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=qs(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){Iu(i,e),Du.set(r,i),js.delete(r)}}}function N0(t,e,r,i){if(T0(r,t),A0(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=yu(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let f=0;f<i.length;f++){const p=i[f],g=Number(p>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[f])}let d=s;for(let f=c.length-1,p=s;f>0;f--)p=p.add(c[f]),d=d.add(p);if(u=u.add(d),h!==0)for(let f=0;f<o;f++)u=u.double()}return u}function Su(t){return S0(t.Fp),Nr(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...bu(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const pr=BigInt(0),zs=BigInt(1);function R0(t){return Nr(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function C0(t){const e=R0(t),{P:r}=e,i=w=>Me(w,r),s=e.montgomeryBits,n=Math.ceil(s/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>mu(w,r-BigInt(2),r));function l(w,b,E){const O=i(w*(b-E));return b=i(b-O),E=i(E+O),[b,E]}const u=(e.a-BigInt(2))/BigInt(4);function h(w,b){_t("u",w,pr,r),_t("scalar",b,pr,r);const E=b,O=w;let $=zs,S=pr,T=w,I=zs,j=pr,B;for(let q=BigInt(s-1);q>=pr;q--){const P=E>>q&zs;j^=P,B=l(j,$,T),$=B[0],T=B[1],B=l(j,S,I),S=B[0],I=B[1],j=P;const _=$+S,v=i(_*_),x=$-S,A=i(x*x),D=v-A,C=T+I,U=T-I,M=i(U*_),z=i(C*x),F=M+z,V=M-z;T=i(F*F),I=i(O*i(V*V)),$=i(v*A),S=i(D*(v+i(u*D)))}B=l(j,$,T),$=B[0],T=B[1],B=l(j,S,I),S=B[0],I=B[1];const k=c(S);return i($*k)}function d(w){return ls(i(w),n)}function f(w){const b=Ke("u coordinate",w,n);return o===32&&(b[31]&=127),ii(b)}function p(w){const b=Ke("scalar",w),E=b.length;if(E!==n&&E!==o){let O=""+n+" or "+o;throw new Error("invalid scalar, expected "+O+" bytes, got "+E)}return ii(a(b))}function g(w,b){const E=f(b),O=p(w),$=h(E,O);if($===pr)throw new Error("invalid private or public key received");return d($)}const y=d(e.Gu);function m(w){return g(w,y)}return{scalarMult:g,scalarMultBase:m,getSharedSecret:(w,b)=>g(w,b),getPublicKey:w=>m(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:y}}const wn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const L0=BigInt(1),Ga=BigInt(2),B0=BigInt(3),U0=BigInt(5);BigInt(8);function k0(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=wn,o=t*t%n*t%n,a=it(o,Ga,n)*o%n,c=it(a,L0,n)*t%n,l=it(c,U0,n)*c%n,u=it(l,e,n)*l%n,h=it(u,r,n)*u%n,d=it(h,i,n)*h%n,f=it(d,s,n)*d%n,p=it(f,s,n)*d%n,g=it(p,e,n)*l%n;return{pow_p_5_8:it(g,Ga,n)*t%n,b2:o}}function M0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const mn=C0({P:wn,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=wn,{pow_p_5_8:r,b2:i}=k0(t);return Me(it(r,B0,e)*i,e)},adjustScalarBytes:M0,randomBytes:Pr});function Ya(t){t.lowS!==void 0&&_r("lowS",t.lowS),t.prehash!==void 0&&_r("prehash",t.prehash)}function j0(t){const e=Su(t);Nr(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:i,a:s}=e;if(r){if(!i.eql(s,i.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:q0,hexToBytes:z0}=v0;class F0 extends Error{constructor(e=""){super(e)}}const vt={Err:F0,_tlv:{encode:(t,e)=>{const{Err:r}=vt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=yr(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?yr(s.length/2|128):"";return yr(t)+n+s+e},decode(t,e){const{Err:r}=vt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=vt;if(t<Et)throw new e("integer: negative integers are not allowed");let r=yr(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=vt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return q0(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=vt,s=typeof t=="string"?z0(t):t;fi(s);const{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=vt,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}},Et=BigInt(0),we=BigInt(1);BigInt(2);const Ja=BigInt(3);BigInt(4);function K0(t){const e=j0(t),{Fp:r}=e,i=vu(e.n,e.nBitLength),s=e.toBytes||((g,y,m)=>{const w=y.toAffine();return si(Uint8Array.from([4]),r.toBytes(w.x),r.toBytes(w.y))}),n=e.fromBytes||(g=>{const y=g.subarray(1),m=r.fromBytes(y.subarray(0,r.BYTES)),w=r.fromBytes(y.subarray(r.BYTES,2*r.BYTES));return{x:m,y:w}});function o(g){const{a:y,b:m}=e,w=r.sqr(g),b=r.mul(w,g);return r.add(r.add(b,r.mul(g,y)),m)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return us(g,we,e.n)}function c(g){const{allowedPrivateKeyLengths:y,nByteLength:m,wrapPrivateKey:w,n:b}=e;if(y&&typeof g!="bigint"){if(Qt(g)&&(g=Ir(g)),typeof g!="string"||!y.includes(g.length))throw new Error("invalid private key");g=g.padStart(m*2,"0")}let E;try{E=typeof g=="bigint"?g:Gt(Ke("private key",g,m))}catch{throw new Error("invalid private key, expected hex or "+m+" bytes, got "+typeof g)}return w&&(E=Me(E,b)),_t("private key",E,we,b),E}function l(g){if(!(g instanceof d))throw new Error("ProjectivePoint expected")}const u=fn((g,y)=>{const{px:m,py:w,pz:b}=g;if(r.eql(b,r.ONE))return{x:m,y:w};const E=g.is0();y==null&&(y=E?r.ONE:r.inv(b));const O=r.mul(m,y),$=r.mul(w,y),S=r.mul(b,y);if(E)return{x:r.ZERO,y:r.ZERO};if(!r.eql(S,r.ONE))throw new Error("invZ was invalid");return{x:O,y:$}}),h=fn(g=>{if(g.is0()){if(e.allowInfinityPoint&&!r.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:y,y:m}=g.toAffine();if(!r.isValid(y)||!r.isValid(m))throw new Error("bad point: x or y not FE");const w=r.sqr(m),b=o(y);if(!r.eql(w,b))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(y,m,w){if(this.px=y,this.py=m,this.pz=w,y==null||!r.isValid(y))throw new Error("x required");if(m==null||!r.isValid(m))throw new Error("y required");if(w==null||!r.isValid(w))throw new Error("z required");Object.freeze(this)}static fromAffine(y){const{x:m,y:w}=y||{};if(!y||!r.isValid(m)||!r.isValid(w))throw new Error("invalid affine point");if(y instanceof d)throw new Error("projective point not allowed");const b=E=>r.eql(E,r.ZERO);return b(m)&&b(w)?d.ZERO:new d(m,w,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){const m=r.invertBatch(y.map(w=>w.pz));return y.map((w,b)=>w.toAffine(m[b])).map(d.fromAffine)}static fromHex(y){const m=d.fromAffine(n(Ke("pointHex",y)));return m.assertValidity(),m}static fromPrivateKey(y){return d.BASE.multiply(c(y))}static msm(y,m){return N0(d,i,y,m)}_setWindowSize(y){p.setWindowSize(this,y)}assertValidity(){h(this)}hasEvenY(){const{y}=this.toAffine();if(r.isOdd)return!r.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){l(y);const{px:m,py:w,pz:b}=this,{px:E,py:O,pz:$}=y,S=r.eql(r.mul(m,$),r.mul(E,b)),T=r.eql(r.mul(w,$),r.mul(O,b));return S&&T}negate(){return new d(this.px,r.neg(this.py),this.pz)}double(){const{a:y,b:m}=e,w=r.mul(m,Ja),{px:b,py:E,pz:O}=this;let $=r.ZERO,S=r.ZERO,T=r.ZERO,I=r.mul(b,b),j=r.mul(E,E),B=r.mul(O,O),k=r.mul(b,E);return k=r.add(k,k),T=r.mul(b,O),T=r.add(T,T),$=r.mul(y,T),S=r.mul(w,B),S=r.add($,S),$=r.sub(j,S),S=r.add(j,S),S=r.mul($,S),$=r.mul(k,$),T=r.mul(w,T),B=r.mul(y,B),k=r.sub(I,B),k=r.mul(y,k),k=r.add(k,T),T=r.add(I,I),I=r.add(T,I),I=r.add(I,B),I=r.mul(I,k),S=r.add(S,I),B=r.mul(E,O),B=r.add(B,B),I=r.mul(B,k),$=r.sub($,I),T=r.mul(B,j),T=r.add(T,T),T=r.add(T,T),new d($,S,T)}add(y){l(y);const{px:m,py:w,pz:b}=this,{px:E,py:O,pz:$}=y;let S=r.ZERO,T=r.ZERO,I=r.ZERO;const j=e.a,B=r.mul(e.b,Ja);let k=r.mul(m,E),q=r.mul(w,O),P=r.mul(b,$),_=r.add(m,w),v=r.add(E,O);_=r.mul(_,v),v=r.add(k,q),_=r.sub(_,v),v=r.add(m,b);let x=r.add(E,$);return v=r.mul(v,x),x=r.add(k,P),v=r.sub(v,x),x=r.add(w,b),S=r.add(O,$),x=r.mul(x,S),S=r.add(q,P),x=r.sub(x,S),I=r.mul(j,v),S=r.mul(B,P),I=r.add(S,I),S=r.sub(q,I),I=r.add(q,I),T=r.mul(S,I),q=r.add(k,k),q=r.add(q,k),P=r.mul(j,P),v=r.mul(B,v),q=r.add(q,P),P=r.sub(k,P),P=r.mul(j,P),v=r.add(v,P),k=r.mul(q,v),T=r.add(T,k),k=r.mul(x,v),S=r.mul(_,S),S=r.sub(S,k),k=r.mul(_,q),I=r.mul(x,I),I=r.add(I,k),new d(S,T,I)}subtract(y){return this.add(y.negate())}is0(){return this.equals(d.ZERO)}wNAF(y){return p.wNAFCached(this,y,d.normalizeZ)}multiplyUnsafe(y){const{endo:m,n:w}=e;_t("scalar",y,Et,w);const b=d.ZERO;if(y===Et)return b;if(this.is0()||y===we)return this;if(!m||p.hasPrecomputes(this))return p.wNAFCachedUnsafe(this,y,d.normalizeZ);let{k1neg:E,k1:O,k2neg:$,k2:S}=m.splitScalar(y),T=b,I=b,j=this;for(;O>Et||S>Et;)O&we&&(T=T.add(j)),S&we&&(I=I.add(j)),j=j.double(),O>>=we,S>>=we;return E&&(T=T.negate()),$&&(I=I.negate()),I=new d(r.mul(I.px,m.beta),I.py,I.pz),T.add(I)}multiply(y){const{endo:m,n:w}=e;_t("scalar",y,we,w);let b,E;if(m){const{k1neg:O,k1:$,k2neg:S,k2:T}=m.splitScalar(y);let{p:I,f:j}=this.wNAF($),{p:B,f:k}=this.wNAF(T);I=p.constTimeNegate(O,I),B=p.constTimeNegate(S,B),B=new d(r.mul(B.px,m.beta),B.py,B.pz),b=I.add(B),E=j.add(k)}else{const{p:O,f:$}=this.wNAF(y);b=O,E=$}return d.normalizeZ([b,E])[0]}multiplyAndAddUnsafe(y,m,w){const b=d.BASE,E=($,S)=>S===Et||S===we||!$.equals(b)?$.multiplyUnsafe(S):$.multiply(S),O=E(this,m).add(E(y,w));return O.is0()?void 0:O}toAffine(y){return u(this,y)}isTorsionFree(){const{h:y,isTorsionFree:m}=e;if(y===we)return!0;if(m)return m(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:y,clearCofactor:m}=e;return y===we?this:m?m(d,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return _r("isCompressed",y),this.assertValidity(),s(d,this,y)}toHex(y=!0){return _r("isCompressed",y),Ir(this.toRawBytes(y))}}d.BASE=new d(e.Gx,e.Gy,r.ONE),d.ZERO=new d(r.ZERO,r.ONE,r.ZERO);const f=e.nBitLength,p=P0(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function V0(t){const e=Su(t);return Nr(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function H0(t){const e=V0(t),{Fp:r,n:i}=e,s=r.BYTES+1,n=2*r.BYTES+1;function o(P){return Me(P,i)}function a(P){return yn(P,i)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=K0({...e,toBytes(P,_,v){const x=_.toAffine(),A=r.toBytes(x.x),D=si;return _r("isCompressed",v),v?D(Uint8Array.from([_.hasEvenY()?2:3]),A):D(Uint8Array.from([4]),A,r.toBytes(x.y))},fromBytes(P){const _=P.length,v=P[0],x=P.subarray(1);if(_===s&&(v===2||v===3)){const A=Gt(x);if(!us(A,we,r.ORDER))throw new Error("Point is not on curve");const D=u(A);let C;try{C=r.sqrt(D)}catch(M){const z=M instanceof Error?": "+M.message:"";throw new Error("Point is not on curve"+z)}const U=(C&we)===we;return(v&1)===1!==U&&(C=r.neg(C)),{x:A,y:C}}else if(_===n&&v===4){const A=r.fromBytes(x.subarray(0,r.BYTES)),D=r.fromBytes(x.subarray(r.BYTES,2*r.BYTES));return{x:A,y:D}}else{const A=s,D=n;throw new Error("invalid Point, expected length of "+A+", or uncompressed "+D+", got "+_)}}}),d=P=>Ir(Sr(P,e.nByteLength));function f(P){const _=i>>we;return P>_}function p(P){return f(P)?o(-P):P}const g=(P,_,v)=>Gt(P.slice(_,v));class y{constructor(_,v,x){this.r=_,this.s=v,this.recovery=x,this.assertValidity()}static fromCompact(_){const v=e.nByteLength;return _=Ke("compactSignature",_,v*2),new y(g(_,0,v),g(_,v,2*v))}static fromDER(_){const{r:v,s:x}=vt.toSig(Ke("DER",_));return new y(v,x)}assertValidity(){_t("r",this.r,we,i),_t("s",this.s,we,i)}addRecoveryBit(_){return new y(this.r,this.s,_)}recoverPublicKey(_){const{r:v,s:x,recovery:A}=this,D=$(Ke("msgHash",_));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const C=A===2||A===3?v+e.n:v;if(C>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=A&1?"03":"02",M=c.fromHex(U+d(C)),z=a(C),F=o(-D*z),V=o(x*z),G=c.BASE.multiplyAndAddUnsafe(M,F,V);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Dr(this.toDERHex())}toDERHex(){return vt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Dr(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const m={isValidPrivateKey(P){try{return l(P),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const P=_u(e.n);return x0(e.randomBytes(P),e.n)},precompute(P=8,_=c.BASE){return _._setWindowSize(P),_.multiply(BigInt(3)),_}};function w(P,_=!0){return c.fromPrivateKey(P).toRawBytes(_)}function b(P){const _=Qt(P),v=typeof P=="string",x=(_||v)&&P.length;return _?x===s||x===n:v?x===2*s||x===2*n:P instanceof c}function E(P,_,v=!0){if(b(P))throw new Error("first arg must be private key");if(!b(_))throw new Error("second arg must be public key");return c.fromHex(_).multiply(l(P)).toRawBytes(v)}const O=e.bits2int||function(P){if(P.length>8192)throw new Error("input is too large");const _=Gt(P),v=P.length*8-e.nBitLength;return v>0?_>>BigInt(v):_},$=e.bits2int_modN||function(P){return o(O(P))},S=to(e.nBitLength);function T(P){return _t("num < 2^"+e.nBitLength,P,Et,S),Sr(P,e.nByteLength)}function I(P,_,v=j){if(["recovered","canonical"].some(Q=>Q in v))throw new Error("sign() legacy options not supported");const{hash:x,randomBytes:A}=e;let{lowS:D,prehash:C,extraEntropy:U}=v;D==null&&(D=!0),P=Ke("msgHash",P),Ya(v),C&&(P=Ke("prehashed msgHash",x(P)));const M=$(P),z=l(_),F=[T(z),T(M)];if(U!=null&&U!==!1){const Q=U===!0?A(r.BYTES):U;F.push(Ke("extraEntropy",Q))}const V=si(...F),G=M;function ie(Q){const Y=O(Q);if(!h(Y))return;const Te=a(Y),Ee=c.BASE.multiply(Y).toAffine(),Pe=o(Ee.x);if(Pe===Et)return;const We=o(Te*o(G+Pe*z));if(We===Et)return;let Ge=(Ee.x===Pe?0:2)|Number(Ee.y&we),or=We;return D&&f(We)&&(or=p(We),Ge^=1),new y(Pe,or,Ge)}return{seed:V,k2sig:ie}}const j={lowS:e.lowS,prehash:!1},B={lowS:e.lowS,prehash:!1};function k(P,_,v=j){const{seed:x,k2sig:A}=I(P,_,v),D=e;return wu(D.hash.outputLen,D.nByteLength,D.hmac)(x,A)}c.BASE._setWindowSize(8);function q(P,_,v,x=B){var We;const A=P;_=Ke("msgHash",_),v=Ke("publicKey",v);const{lowS:D,prehash:C,format:U}=x;if(Ya(x),"strict"in x)throw new Error("options.strict was renamed to lowS");if(U!==void 0&&U!=="compact"&&U!=="der")throw new Error("format must be compact or der");const M=typeof A=="string"||Qt(A),z=!M&&!U&&typeof A=="object"&&A!==null&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!M&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let F,V;try{if(z&&(F=new y(A.r,A.s)),M){try{U!=="compact"&&(F=y.fromDER(A))}catch(Ge){if(!(Ge instanceof vt.Err))throw Ge}!F&&U!=="der"&&(F=y.fromCompact(A))}V=c.fromHex(v)}catch{return!1}if(!F||D&&F.hasHighS())return!1;C&&(_=e.hash(_));const{r:G,s:ie}=F,Q=$(_),Y=a(ie),Te=o(Q*Y),Ee=o(G*Y),Pe=(We=c.BASE.multiplyAndAddUnsafe(V,Te,Ee))==null?void 0:We.toAffine();return Pe?o(Pe.x)===G:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:E,sign:k,verify:q,ProjectivePoint:c,Signature:y,utils:m}}function W0(t){return{hash:t,hmac:(e,...r)=>os(t,e,Zm(...r)),randomBytes:Pr}}function G0(t,e){const r=i=>H0({...t,...W0(i)});return{...r(e),create:r}}const Ou=vu(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Y0=Ou.create(BigInt("-3")),J0=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Z0=G0({a:Y0,b:J0,Fp:Ou,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},pi),$u="base10",Re="base16",nt="base64pad",Pt="base64url",gi="utf8",xu=0,It=1,yi=2,X0=0,Za=1,Gr=12,ro=32;function Q0(){const t=mn.utils.randomPrivateKey(),e=mn.getPublicKey(t);return{privateKey:je(t,Re),publicKey:je(e,Re)}}function bn(){const t=Pr(ro);return je(t,Re)}function ev(t,e){const r=mn.getSharedSecret(Xe(t,Re),Xe(e,Re)),i=s0(pi,r,void 0,void 0,ro);return je(i,Re)}function ki(t){const e=pi(Xe(t,Re));return je(e,Re)}function dt(t){const e=pi(Xe(t,gi));return je(e,Re)}function Tu(t){return Xe(`${t}`,$u)}function er(t){return Number(je(t,$u))}function Au(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Pu(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function tv(t){const e=Tu(typeof t.type<"u"?t.type:xu);if(er(e)===It&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?Xe(t.senderPublicKey,Re):void 0,i=typeof t.iv<"u"?Xe(t.iv,Re):Pr(Gr),s=Xe(t.symKey,Re),n=fu(s,i).encrypt(Xe(t.message,gi)),o=Nu({type:e,sealed:n,iv:i,senderPublicKey:r});return t.encoding===Pt?Au(o):o}function rv(t){const e=Xe(t.symKey,Re),{sealed:r,iv:i}=ni({encoded:t.encoded,encoding:t.encoding}),s=fu(e,i).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return je(s,gi)}function iv(t,e){const r=Tu(yi),i=Pr(Gr),s=Xe(t,gi),n=Nu({type:r,sealed:s,iv:i});return e===Pt?Au(n):n}function sv(t,e){const{sealed:r}=ni({encoded:t,encoding:e});return je(r,gi)}function Nu(t){if(er(t.type)===yi)return je(Wr([t.type,t.sealed]),nt);if(er(t.type)===It){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return je(Wr([t.type,t.senderPublicKey,t.iv,t.sealed]),nt)}return je(Wr([t.type,t.iv,t.sealed]),nt)}function ni(t){const e=(t.encoding||nt)===Pt?Pu(t.encoded):t.encoded,r=Xe(e,nt),i=r.slice(X0,Za),s=Za;if(er(i)===It){const c=s+ro,l=c+Gr,u=r.slice(s,c),h=r.slice(c,l),d=r.slice(l);return{type:i,sealed:d,iv:h,senderPublicKey:u}}if(er(i)===yi){const c=r.slice(s),l=Pr(Gr);return{type:i,sealed:c,iv:l}}const n=s+Gr,o=r.slice(s,n),a=r.slice(n);return{type:i,sealed:a,iv:o}}function nv(t,e){const r=ni({encoded:t,encoding:e==null?void 0:e.encoding});return Ru({type:er(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?je(r.senderPublicKey,Re):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ru(t){const e=(t==null?void 0:t.type)||xu;if(e===It){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Xa(t){return t.type===It&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Qa(t){return t.type===yi}function ov(t){const e=Dt.from(t.x,"base64"),r=Dt.from(t.y,"base64");return Wr([new Uint8Array([4]),e,r])}function av(t,e){const[r,i,s]=t.split("."),n=Dt.from(Pu(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${r}.${i}`,l=pi(c),u=ov(e);if(!Z0.verify(Wr([o,a]),l,u))throw new Error("Invalid signature");return nn(t).payload}const cv="irn";function Yi(t){return(t==null?void 0:t.relay)||{protocol:cv}}function Vr(t){const e=pm[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function lv(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=t[s];r[n]=o}}),r}function ec(t){if(!t.includes("wc:")){const l=tu(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),n=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(n),a={};o.forEach((l,u)=>{a[u]=l});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:uv(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:lv(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function uv(t){return t.startsWith("//")?t.substring(2):t}function hv(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const n=s,o=r+e+n;t[n]&&(i[o]=t[n])}),i}function tc(t){const e=new URLSearchParams,r=hv(t.relay);Object.keys(r).sort().forEach(s=>{e.set(s,r[s])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const i=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${i}`}function Ai(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var dv=Object.defineProperty,pv=Object.defineProperties,fv=Object.getOwnPropertyDescriptors,rc=Object.getOwnPropertySymbols,gv=Object.prototype.hasOwnProperty,yv=Object.prototype.propertyIsEnumerable,ic=(t,e,r)=>e in t?dv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wv=(t,e)=>{for(var r in e||(e={}))gv.call(e,r)&&ic(t,r,e[r]);if(rc)for(var r of rc(e))yv.call(e,r)&&ic(t,r,e[r]);return t},mv=(t,e)=>pv(t,fv(e));function Rr(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function bv(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Rr(r.accounts))}),e}function vv(t,e){const r=[];return Object.values(t).forEach(i=>{Rr(i.accounts).includes(e)&&r.push(...i.methods)}),r}function Ev(t,e){const r=[];return Object.values(t).forEach(i=>{Rr(i.accounts).includes(e)&&r.push(...i.events)}),r}function Cu(t){return t.includes(":")}function _v(t){return Cu(t)?t.split(":")[0]:t}function sc(t){var e,r,i;const s={};if(!oi(t))return s;for(const[n,o]of Object.entries(t)){const a=Cu(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],u=_v(n);s[u]=mv(wv({},s[u]),{chains:Wt(a,(e=s[u])==null?void 0:e.chains),methods:Wt(c,(r=s[u])==null?void 0:r.methods),events:Wt(l,(i=s[u])==null?void 0:i.events)})}return s}function Iv(t){const e={};return t==null||t.forEach(r=>{var i;const[s,n]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function nc(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=Iv(e);for(const[i,s]of Object.entries(r))s.methods?s.methods=Wt(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function Dv(t,e){var r,i,s,n,o,a;const c=sc(t),l=sc(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const d of h)u[d]={chains:Wt((r=c[d])==null?void 0:r.chains,(i=l[d])==null?void 0:i.chains),methods:Wt((s=c[d])==null?void 0:s.methods,(n=l[d])==null?void 0:n.methods),events:Wt((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return u}const Sv={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Ov={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function L(t,e){const{message:r,code:i}=Ov[t];return{message:e?`${r} ${e}`:r,code:i}}function ne(t,e){const{message:r,code:i}=Sv[t];return{message:e?`${r} ${e}`:r,code:i}}function wi(t,e){return!!Array.isArray(t)}function oi(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Se(t){return typeof t>"u"}function he(t,e){return e&&Se(t)?!0:typeof t=="string"&&!!t.trim().length}function io(t,e){return e&&Se(t)?!0:typeof t=="number"&&!isNaN(t)}function $v(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let n=!0;return Ht(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=Rr(a),h=r[o];(!Ht(Jl(o,h),u)||!Ht(h.methods,c)||!Ht(h.events,l))&&(n=!1)}),n):!1}function Ji(t){return he(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function xv(t){if(he(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Ji(r)}}return!1}function Tv(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(he(t,!1)){if(e(t))return!0;const r=tu(t);return e(r)}}catch{}return!1}function Av(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Pv(t){return t==null?void 0:t.topic}function Nv(t,e){let r=null;return he(t==null?void 0:t.publicKey,!1)||(r=L("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function oc(t){let e=!0;return wi(t)?t.length&&(e=t.every(r=>he(r,!1))):e=!1,e}function Rv(t,e,r){let i=null;return wi(e)&&e.length?e.forEach(s=>{i||Ji(s)||(i=ne("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Ji(t)||(i=ne("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Cv(t,e,r){let i=null;return Object.entries(t).forEach(([s,n])=>{if(i)return;const o=Rv(s,Jl(s,n),`${e} ${r}`);o&&(i=o)}),i}function Lv(t,e){let r=null;return wi(t)?t.forEach(i=>{r||xv(i)||(r=ne("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=ne("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Bv(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=Lv(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function Uv(t,e){let r=null;return oc(t==null?void 0:t.methods)?oc(t==null?void 0:t.events)||(r=ne("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ne("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Lu(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=Uv(i,`${e}, namespace`);s&&(r=s)}),r}function kv(t,e,r){let i=null;if(t&&oi(t)){const s=Lu(t,e);s&&(i=s);const n=Cv(t,e,r);n&&(i=n)}else i=L("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Fs(t,e){let r=null;if(t&&oi(t)){const i=Lu(t,e);i&&(r=i);const s=Bv(t,e);s&&(r=s)}else r=L("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Bu(t){return he(t.protocol,!0)}function Mv(t,e){let r=!1;return t?t&&wi(t)&&t.length&&t.forEach(i=>{r=Bu(i)}):r=!0,r}function jv(t){return typeof t=="number"}function ke(t){return typeof t<"u"&&typeof t!==null}function qv(t){return!(!t||typeof t!="object"||!t.code||!io(t.code,!1)||!t.message||!he(t.message,!1))}function zv(t){return!(Se(t)||!he(t.method,!1))}function Fv(t){return!(Se(t)||Se(t.result)&&Se(t.error)||!io(t.id,!1)||!he(t.jsonrpc,!1))}function Kv(t){return!(Se(t)||!he(t.name,!1))}function ac(t,e){return!(!Ji(e)||!bv(t).includes(e))}function Vv(t,e,r){return he(r,!1)?vv(t,e).includes(r):!1}function Hv(t,e,r){return he(r,!1)?Ev(t,e).includes(r):!1}function cc(t,e,r){let i=null;const s=Wv(t),n=Gv(e),o=Object.keys(s),a=Object.keys(n),c=lc(Object.keys(t)),l=lc(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Ht(o,a)||(i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const d=Rr(e[h].accounts);d.includes(h)||(i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{i||(Ht(s[h].methods,n[h].methods)?Ht(s[h].events,n[h].events)||(i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):i=L("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function Wv(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function lc(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Gv(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=Rr(t[r].accounts);i==null||i.forEach(s=>{e[s]={accounts:t[r].accounts.filter(n=>n.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function Yv(t,e){return io(t,!1)&&t<=e.max&&t>=e.min}function uc(){const t=hi();return new Promise(e=>{switch(t){case He.browser:e(Jv());break;case He.reactNative:e(Zv());break;case He.node:e(Xv());break;default:e(!0)}})}function Jv(){return Ar()&&(navigator==null?void 0:navigator.onLine)}async function Zv(){if(Ct()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo){const t=await(globalThis==null?void 0:globalThis.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function Xv(){return!0}function Qv(t){switch(hi()){case He.browser:eE(t);break;case He.reactNative:tE(t);break}}function eE(t){!Ct()&&Ar()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function tE(t){Ct()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo&&(globalThis==null||globalThis.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function rE(){var t;return Ar()&&Jt()?((t=Jt())==null?void 0:t.visibilityState)==="visible":!0}const Ks={};class jr{static get(e){return Ks[e]}static set(e,r){Ks[e]=r}static delete(e){delete Ks[e]}}class iE{}class sE extends iE{constructor(){super()}}class nE extends sE{constructor(e){super()}}const oE="^wss?:";function aE(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function cE(t,e){const r=aE(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function hc(t){return cE(t,oE)}function lE(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Uu(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function so(t){return Uu(t)&&"method"in t}function hs(t){return Uu(t)&&(ht(t)||Ze(t))}function ht(t){return"result"in t}function Ze(t){return"error"in t}class uE extends nE{constructor(e){super(e),this.events=new ot.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Kt(e.method,e.params||[],e.id||Vt().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{Ze(n)?s(n.error):i(n.result)});try{await this.connection.send(e,r)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),hs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const hE=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),dE=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",dc=t=>t.split("?")[0],pc=10,pE=hE();let fE=class{constructor(e){if(this.url=e,this.events=new ot.EventEmitter,this.registering=!1,!hc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Yt(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!hc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=wh.isReactNative()?void 0:{rejectUnauthorized:!lE(e)},n=new pE(e,[],s);dE()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),r(n)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?mr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=Ln(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return mh(e,dc(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>pc&&this.events.setMaxListeners(pc)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${dc(this.url)}`));return this.events.emit("register_error",r),r}};var Vs=["buffer","Buffer"],gE={};const ku="wc",Mu=2,vn="core",ft=`${ku}@2:${vn}:`,yE={logger:"error"},wE={database:":memory:"},mE="crypto",fc="client_ed25519_seed",bE=R.ONE_DAY,vE="keychain",EE="0.3",_E="messages",IE="0.3",gc=R.SIX_HOURS,DE="publisher",ju="irn",SE="error",qu="wss://relay.walletconnect.org",OE="relayer",me={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},$E="_subscription",Ye={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},xE=.1,En="2.21.0",ae={link_mode:"link_mode",relay:"relay"},Mi={inbound:"inbound",outbound:"outbound"},TE="0.3",AE="WALLETCONNECT_CLIENT_ID",yc="WALLETCONNECT_LINK_MODE_APPS",Fe={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},PE="subscription",NE="0.3",RE="pairing",CE="0.3",qr={wc_pairingDelete:{req:{ttl:R.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:R.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:R.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:R.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:R.ONE_DAY,prompt:!1,tag:0},res:{ttl:R.ONE_DAY,prompt:!1,tag:0}}},Ft={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},et={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},LE="history",BE="0.3",UE="expirer",Je={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},kE="0.3",ME="verify-api",jE="https://verify.walletconnect.com",zu="https://verify.walletconnect.org",Yr=zu,qE=`${Yr}/v3`,zE=[jE,zu],FE="echo",KE="https://echo.walletconnect.com",ut={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},bt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},tt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ut={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},kt={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},zr={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},VE=.1,HE="event-client",WE=86400,GE="https://pulse.walletconnect.org/batch";function YE(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,m=0,w=p.length;m!==w&&p[m]===0;)m++,g++;for(var b=(w-m)*u+1>>>0,E=new Uint8Array(b);m!==w;){for(var O=p[m],$=0,S=b-1;(O!==0||$<y)&&S!==-1;S--,$++)O+=256*E[S]>>>0,E[S]=O%a>>>0,O=O/a>>>0;if(O!==0)throw new Error("Non-zero carry");y=$,m++}for(var T=b-y;T!==b&&E[T]===0;)T++;for(var I=c.repeat(g);T<b;++T)I+=t.charAt(E[T]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,m=0;p[g]===c;)y++,g++;for(var w=(p.length-g)*l+1>>>0,b=new Uint8Array(w);p[g];){var E=r[p.charCodeAt(g)];if(E===255)return;for(var O=0,$=w-1;(E!==0||O<m)&&$!==-1;$--,O++)E+=a*b[$]>>>0,b[$]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=O,g++}if(p[g]!==" "){for(var S=w-m;S!==w&&b[S]===0;)S++;for(var T=new Uint8Array(y+(w-S)),I=y;S!==w;)T[I++]=b[S++];return T}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var JE=YE,ZE=JE;const Fu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},XE=t=>new TextEncoder().encode(t),QE=t=>new TextDecoder().decode(t);class e1{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class t1{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ku(this,e)}}class r1{constructor(e){this.decoders=e}or(e){return Ku(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ku=(t,e)=>new r1({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class i1{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new e1(e,r,i),this.decoder=new t1(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ds=({name:t,prefix:e,encode:r,decode:i})=>new i1(t,e,r,i),mi=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=ZE(r,e);return ds({prefix:t,name:e,encode:i,decode:n=>Fu(s(n))})},s1=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},n1=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},xe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ds({prefix:e,name:t,encode(s){return n1(s,i,r)},decode(s){return s1(s,i,r,t)}}),o1=ds({prefix:"\0",name:"identity",encode:t=>QE(t),decode:t=>XE(t)});var a1=Object.freeze({__proto__:null,identity:o1});const c1=xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var l1=Object.freeze({__proto__:null,base2:c1});const u1=xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var h1=Object.freeze({__proto__:null,base8:u1});const d1=mi({prefix:"9",name:"base10",alphabet:"0123456789"});var p1=Object.freeze({__proto__:null,base10:d1});const f1=xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),g1=xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var y1=Object.freeze({__proto__:null,base16:f1,base16upper:g1});const w1=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),m1=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),b1=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),v1=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),E1=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_1=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),I1=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),D1=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),S1=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var O1=Object.freeze({__proto__:null,base32:w1,base32upper:m1,base32pad:b1,base32padupper:v1,base32hex:E1,base32hexupper:_1,base32hexpad:I1,base32hexpadupper:D1,base32z:S1});const $1=mi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),x1=mi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var T1=Object.freeze({__proto__:null,base36:$1,base36upper:x1});const A1=mi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),P1=mi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var N1=Object.freeze({__proto__:null,base58btc:A1,base58flickr:P1});const R1=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),C1=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),L1=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),B1=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var U1=Object.freeze({__proto__:null,base64:R1,base64pad:C1,base64url:L1,base64urlpad:B1});const Vu=Array.from(""),k1=Vu.reduce((t,e,r)=>(t[r]=e,t),[]),M1=Vu.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function j1(t){return t.reduce((e,r)=>(e+=k1[r],e),"")}function q1(t){const e=[];for(const r of t){const i=M1[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const z1=ds({prefix:"",name:"base256emoji",encode:j1,decode:q1});var F1=Object.freeze({__proto__:null,base256emoji:z1}),K1=Hu,wc=128,V1=-128,H1=Math.pow(2,31);function Hu(t,e,r){e=e||[],r=r||0;for(var i=r;t>=H1;)e[r++]=t&255|wc,t/=128;for(;t&V1;)e[r++]=t&255|wc,t>>>=7;return e[r]=t|0,Hu.bytes=r-i+1,e}var W1=_n,G1=128,mc=127;function _n(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw _n.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&mc)<<s:(o&mc)*Math.pow(2,s),s+=7}while(o>=G1);return _n.bytes=n-i,r}var Y1=Math.pow(2,7),J1=Math.pow(2,14),Z1=Math.pow(2,21),X1=Math.pow(2,28),Q1=Math.pow(2,35),e_=Math.pow(2,42),t_=Math.pow(2,49),r_=Math.pow(2,56),i_=Math.pow(2,63),s_=function(t){return t<Y1?1:t<J1?2:t<Z1?3:t<X1?4:t<Q1?5:t<e_?6:t<t_?7:t<r_?8:t<i_?9:10},n_={encode:K1,decode:W1,encodingLength:s_},Wu=n_;const bc=(t,e,r=0)=>(Wu.encode(t,e,r),e),vc=t=>Wu.encodingLength(t),In=(t,e)=>{const r=e.byteLength,i=vc(t),s=i+vc(r),n=new Uint8Array(s+r);return bc(t,n,0),bc(r,n,i),n.set(e,s),new o_(t,r,e,n)};class o_{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Gu=({name:t,code:e,encode:r})=>new a_(t,e,r);class a_{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?In(this.code,r):r.then(i=>In(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Yu=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),c_=Gu({name:"sha2-256",code:18,encode:Yu("SHA-256")}),l_=Gu({name:"sha2-512",code:19,encode:Yu("SHA-512")});var u_=Object.freeze({__proto__:null,sha256:c_,sha512:l_});const Ju=0,h_="identity",Zu=Fu,d_=t=>In(Ju,Zu(t)),p_={code:Ju,name:h_,encode:Zu,digest:d_};var f_=Object.freeze({__proto__:null,identity:p_});new TextEncoder,new TextDecoder;const Ec={...a1,...l1,...h1,...p1,...y1,...O1,...T1,...N1,...U1,...F1};({...u_,...f_});function g_(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Xu(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const _c=Xu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Hs=Xu("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=g_(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),y_={utf8:_c,"utf-8":_c,hex:Ec.base16,latin1:Hs,ascii:Hs,binary:Hs,...Ec};function w_(t,e="utf8"){const r=y_[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}var m_=Object.defineProperty,b_=(t,e,r)=>e in t?m_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lt=(t,e,r)=>b_(t,typeof e!="symbol"?e+"":e,r);class v_{constructor(e,r){this.core=e,this.logger=r,lt(this,"keychain",new Map),lt(this,"name",vE),lt(this,"version",EE),lt(this,"initialized",!1),lt(this,"storagePrefix",ft),lt(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),lt(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),lt(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),lt(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=L("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),lt(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=Ce(r,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,cn(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ln(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var E_=Object.defineProperty,__=(t,e,r)=>e in t?E_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ie=(t,e,r)=>__(t,typeof e!="symbol"?e+"":e,r);class I_{constructor(e,r,i){this.core=e,this.logger=r,Ie(this,"name",mE),Ie(this,"keychain"),Ie(this,"randomSessionIdentifier",bn()),Ie(this,"initialized",!1),Ie(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Ie(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),Ie(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=ia(s);return Al(n.publicKey)}),Ie(this,"generateKeyPair",()=>{this.isInitialized();const s=Q0();return this.setPrivateKey(s.publicKey,s.privateKey)}),Ie(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=ia(n),a=this.randomSessionIdentifier;return await ty(a,s,bE,o)}),Ie(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=ev(a,n);return this.setSymKey(c,o)}),Ie(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||ki(s);return await this.keychain.set(o,s),o}),Ie(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),Ie(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),Ie(this,"encode",async(s,n,o)=>{this.isInitialized();const a=Ru(o),c=Yt(n);if(Qa(a))return iv(c,o==null?void 0:o.encoding);if(Xa(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;s=await this.generateSharedKey(d,f)}const l=this.getSymKey(s),{type:u,senderPublicKey:h}=a;return tv({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),Ie(this,"decode",async(s,n,o)=>{this.isInitialized();const a=nv(n,o);if(Qa(a)){const c=sv(n,o==null?void 0:o.encoding);return mr(c)}if(Xa(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=rv({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return mr(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Ie(this,"getPayloadType",(s,n=nt)=>{const o=ni({encoded:s,encoding:n});return er(o.type)}),Ie(this,"getPayloadSenderPublicKey",(s,n=nt)=>{const o=ni({encoded:s,encoding:n});return o.senderPublicKey?je(o.senderPublicKey,Re):void 0}),this.core=e,this.logger=Ce(r,this.name),this.keychain=i||new v_(this.core,this.logger)}get context(){return qe(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(fc)}catch{e=bn(),await this.keychain.set(fc,e)}return w_(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var D_=Object.defineProperty,S_=Object.defineProperties,O_=Object.getOwnPropertyDescriptors,Ic=Object.getOwnPropertySymbols,$_=Object.prototype.hasOwnProperty,x_=Object.prototype.propertyIsEnumerable,Dn=(t,e,r)=>e in t?D_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,T_=(t,e)=>{for(var r in e||(e={}))$_.call(e,r)&&Dn(t,r,e[r]);if(Ic)for(var r of Ic(e))x_.call(e,r)&&Dn(t,r,e[r]);return t},A_=(t,e)=>S_(t,O_(e)),ze=(t,e,r)=>Dn(t,typeof e!="symbol"?e+"":e,r);class P_ extends Xd{constructor(e,r){super(e,r),this.logger=e,this.core=r,ze(this,"messages",new Map),ze(this,"messagesWithoutClientAck",new Map),ze(this,"name",_E),ze(this,"version",IE),ze(this,"initialized",!1),ze(this,"storagePrefix",ft),ze(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),ze(this,"set",async(i,s,n)=>{this.isInitialized();const o=dt(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===Mi.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,A_(T_({},c),{[o]:s}))}return await this.persist(),o}),ze(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),ze(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),ze(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=dt(s);return typeof n[o]<"u"}),ze(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=dt(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),ze(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=Ce(e,this.name),this.core=r}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,cn(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,cn(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ln(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?ln(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var N_=Object.defineProperty,R_=Object.defineProperties,C_=Object.getOwnPropertyDescriptors,Dc=Object.getOwnPropertySymbols,L_=Object.prototype.hasOwnProperty,B_=Object.prototype.propertyIsEnumerable,Sn=(t,e,r)=>e in t?N_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pi=(t,e)=>{for(var r in e||(e={}))L_.call(e,r)&&Sn(t,r,e[r]);if(Dc)for(var r of Dc(e))B_.call(e,r)&&Sn(t,r,e[r]);return t},Ws=(t,e)=>R_(t,C_(e)),rt=(t,e,r)=>Sn(t,typeof e!="symbol"?e+"":e,r);class U_ extends Qd{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,rt(this,"events",new ot.EventEmitter),rt(this,"name",DE),rt(this,"queue",new Map),rt(this,"publishTimeout",R.toMiliseconds(R.ONE_MINUTE)),rt(this,"initialPublishTimeout",R.toMiliseconds(R.ONE_SECOND*15)),rt(this,"needsTransportRestart",!1),rt(this,"publish",async(i,s,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const a=(n==null?void 0:n.ttl)||gc,c=Yi(n),l=(n==null?void 0:n.prompt)||!1,u=(n==null?void 0:n.tag)||0,h=(n==null?void 0:n.id)||Vt().toString(),d={topic:i,message:s,opts:{ttl:a,relay:c,prompt:l,tag:u,id:h,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},f=`Failed to publish payload, please try again. id:${h} tag:${u}`;try{const p=new Promise(async g=>{const y=({id:w})=>{d.opts.id===w&&(this.removeRequestFromQueue(w),this.relayer.events.removeListener(me.publish,y),g(d))};this.relayer.events.on(me.publish,y);const m=Nt(new Promise((w,b)=>{this.rpcPublish({topic:i,message:s,ttl:a,prompt:l,tag:u,id:h,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(w).catch(E=>{this.logger.warn(E,E==null?void 0:E.message),b(E)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${u}`);try{await m,this.events.removeListener(me.publish,y)}catch(w){this.queue.set(h,Ws(Pi({},d),{attempt:1})),this.logger.warn(w,w==null?void 0:w.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:i,message:s,opts:n}}),await Nt(p,this.publishTimeout,f)}catch(p){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(p),(o=n==null?void 0:n.internal)!=null&&o.throwOnFailedPublish)throw p}finally{this.queue.delete(h)}}),rt(this,"on",(i,s)=>{this.events.on(i,s)}),rt(this,"once",(i,s)=>{this.events.once(i,s)}),rt(this,"off",(i,s)=>{this.events.off(i,s)}),rt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=Ce(r,this.name),this.registerEventListeners()}get context(){return qe(this.logger)}async rpcPublish(e){var r,i,s,n;const{topic:o,message:a,ttl:c=gc,prompt:l,tag:u,id:h,attestation:d,tvf:f}=e,p={method:Vr(Yi().protocol).publish,params:Pi({topic:o,message:a,ttl:c,prompt:l,tag:u,attestation:d},f),id:h};Se((r=p.params)==null?void 0:r.prompt)&&((i=p.params)==null||delete i.prompt),Se((s=p.params)==null?void 0:s.tag)&&((n=p.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(me.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const i=e.attempt+1;this.queue.set(r,Ws(Pi({},e),{attempt:i}));const{topic:s,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(Ws(Pi({},e),{topic:s,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(rr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(me.connection_stalled);return}this.checkQueue()}),this.relayer.on(me.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var k_=Object.defineProperty,M_=(t,e,r)=>e in t?k_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fr=(t,e,r)=>M_(t,typeof e!="symbol"?e+"":e,r);class j_{constructor(){fr(this,"map",new Map),fr(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),fr(this,"get",e=>this.map.get(e)||[]),fr(this,"exists",(e,r)=>this.get(e).includes(r)),fr(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(n=>n!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),fr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var q_=Object.defineProperty,z_=Object.defineProperties,F_=Object.getOwnPropertyDescriptors,Sc=Object.getOwnPropertySymbols,K_=Object.prototype.hasOwnProperty,V_=Object.prototype.propertyIsEnumerable,On=(t,e,r)=>e in t?q_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fr=(t,e)=>{for(var r in e||(e={}))K_.call(e,r)&&On(t,r,e[r]);if(Sc)for(var r of Sc(e))V_.call(e,r)&&On(t,r,e[r]);return t},Gs=(t,e)=>z_(t,F_(e)),te=(t,e,r)=>On(t,typeof e!="symbol"?e+"":e,r);class H_ extends rp{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,te(this,"subscriptions",new Map),te(this,"topicMap",new j_),te(this,"events",new ot.EventEmitter),te(this,"name",PE),te(this,"version",NE),te(this,"pending",new Map),te(this,"cached",[]),te(this,"initialized",!1),te(this,"storagePrefix",ft),te(this,"subscribeTimeout",R.toMiliseconds(R.ONE_MINUTE)),te(this,"initialSubscribeTimeout",R.toMiliseconds(R.ONE_SECOND*15)),te(this,"clientId"),te(this,"batchSubscribeTopicsLimit",500),te(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),te(this,"subscribe",async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const n=Yi(s),o={topic:i,relay:n,transportType:s==null?void 0:s.transportType};this.pending.set(i,o);const a=await this.rpcSubscribe(i,n,s);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),te(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),te(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),te(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),te(this,"on",(i,s)=>{this.events.on(i,s)}),te(this,"once",(i,s)=>{this.events.once(i,s)}),te(this,"off",(i,s)=>{this.events.off(i,s)}),te(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),te(this,"start",async()=>{await this.onConnect()}),te(this,"stop",async()=>{await this.onDisconnect()}),te(this,"restart",async()=>{await this.restore(),await this.onRestart()}),te(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),te(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(rr.pulse,async()=>{await this.checkPending()}),this.events.on(Fe.created,async i=>{const s=Fe.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(Fe.deleted,async i=>{const s=Fe.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=Ce(r,this.name),this.clientId=""}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Yi(i);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const n=ne("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,i){var s;(!i||(i==null?void 0:i.transportType)===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const n={method:Vr(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(s=i==null?void 0:i.internal)==null?void 0:s.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((i==null?void 0:i.transportType)===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(u=>this.logger.warn(u))},R.toMiliseconds(R.ONE_SECOND)),a;const c=new Promise(async u=>{const h=d=>{d.topic===e&&(this.events.removeListener(Fe.created,h),u(d.id))};this.events.on(Fe.created,h);try{const d=await Nt(new Promise((f,p)=>{this.relayer.request(n).catch(g=>{this.logger.warn(g,g==null?void 0:g.message),p(g)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Fe.created,h),u(d)}catch{}}),l=await Nt(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return l?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(me.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:Vr(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Nt(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(me.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:Vr(r.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Nt(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(me.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:Vr(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,Gs(Fr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Fr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Fr({},r)),this.topicMap.set(r.topic,e),this.events.emit(Fe.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Fe.deleted,Gs(Fr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Fe.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Fe.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>Gs(Fr({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await jm(R.toMiliseconds(R.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return dt(e+await this.getClientId())}}var W_=Object.defineProperty,Oc=Object.getOwnPropertySymbols,G_=Object.prototype.hasOwnProperty,Y_=Object.prototype.propertyIsEnumerable,$n=(t,e,r)=>e in t?W_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$c=(t,e)=>{for(var r in e||(e={}))G_.call(e,r)&&$n(t,r,e[r]);if(Oc)for(var r of Oc(e))Y_.call(e,r)&&$n(t,r,e[r]);return t},Z=(t,e,r)=>$n(t,typeof e!="symbol"?e+"":e,r);class J_ extends ep{constructor(e){super(e),Z(this,"protocol","wc"),Z(this,"version",2),Z(this,"core"),Z(this,"logger"),Z(this,"events",new ot.EventEmitter),Z(this,"provider"),Z(this,"messages"),Z(this,"subscriber"),Z(this,"publisher"),Z(this,"name",OE),Z(this,"transportExplicitlyClosed",!1),Z(this,"initialized",!1),Z(this,"connectionAttemptInProgress",!1),Z(this,"relayUrl"),Z(this,"projectId"),Z(this,"packageName"),Z(this,"bundleId"),Z(this,"hasExperiencedNetworkDisruption",!1),Z(this,"pingTimeout"),Z(this,"heartBeatTimeout",R.toMiliseconds(R.THIRTY_SECONDS+R.FIVE_SECONDS)),Z(this,"reconnectTimeout"),Z(this,"connectPromise"),Z(this,"reconnectInProgress",!1),Z(this,"requestsInFlight",[]),Z(this,"connectTimeout",R.toMiliseconds(R.ONE_SECOND*15)),Z(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");const n=r.id||Vt().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),Z(this,"resetPingTimeout",()=>{Wi()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),Z(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),Z(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(me.connect)}),Z(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),Z(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(me.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Z(this,"registerProviderListeners",()=>{this.provider.on(Ye.payload,this.onPayloadHandler),this.provider.on(Ye.connect,this.onConnectHandler),this.provider.on(Ye.disconnect,this.onDisconnectHandler),this.provider.on(Ye.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ce(e.logger,this.name):es(Mn({level:e.logger||SE})),this.messages=new P_(this.logger,e.core),this.subscriber=new H_(this,this.logger),this.publisher=new U_(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||qu,this.projectId=e.projectId,Dm()?this.packageName=_a():Sm()&&(this.bundleId=_a()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return qe(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ae.relay},Mi.outbound)}async subscribe(e,r){var i,s,n;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=r==null?void 0:r.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(Fe.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Fe.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,$c({internal:{throwOnFailedPublish:o}},r)).catch(d=>{o&&h(d)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Nt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await uc())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const s=pe(R.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(me.message,e),await this.recordMessageEvent(e,Mi.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ye.disconnect,n),await Nt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(Ye.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ye.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Ye.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,R.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,s,n;if(Wi())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new uE(new fE(Am({sdkVersion:En,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:s}=e;await this.messages.set(i,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),so(e)){if(!e.method.endsWith($E))return;const r=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=r.data,a={topic:i,message:s,publishedAt:n,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace($c({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else hs(e)&&this.events.emit(me.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Mi.inbound),this.events.emit(me.message,e))}async acknowledgePayload(e){const r=Bn(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Ye.payload,this.onPayloadHandler),this.provider.off(Ye.connect,this.onConnectHandler),this.provider.off(Ye.disconnect,this.onDisconnectHandler),this.provider.off(Ye.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await uc();Qv(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(rr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&rE())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(me.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},R.toMiliseconds(xE)))))}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function Z_(){}function xc(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function Tc(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Ac(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const X_="[object RegExp]",Q_="[object String]",e2="[object Number]",t2="[object Boolean]",Pc="[object Arguments]",r2="[object Symbol]",i2="[object Date]",s2="[object Map]",n2="[object Set]",o2="[object Array]",a2="[object Function]",c2="[object ArrayBuffer]",Ys="[object Object]",l2="[object Error]",u2="[object DataView]",h2="[object Uint8Array]",d2="[object Uint8ClampedArray]",p2="[object Uint16Array]",f2="[object Uint32Array]",g2="[object BigUint64Array]",y2="[object Int8Array]",w2="[object Int16Array]",m2="[object Int32Array]",b2="[object BigInt64Array]",v2="[object Float32Array]",E2="[object Float64Array]";function _2(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function I2(t,e,r){return Hr(t,e,void 0,void 0,void 0,void 0,r)}function Hr(t,e,r,i,s,n,o){const a=o(t,e,r,i,s,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Jr(t,e,n,o)}return Jr(t,e,n,o)}function Jr(t,e,r,i){if(Object.is(t,e))return!0;let s=Ac(t),n=Ac(e);if(s===Pc&&(s=Ys),n===Pc&&(n=Ys),s!==n)return!1;switch(s){case Q_:return t.toString()===e.toString();case e2:{const c=t.valueOf(),l=e.valueOf();return _2(c,l)}case t2:case i2:case r2:return Object.is(t.valueOf(),e.valueOf());case X_:return t.source===e.source&&t.flags===e.flags;case a2:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case s2:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Hr(l,e.get(c),c,t,e,r,i))return!1;return!0}case n2:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],d=l.findIndex(f=>Hr(h,f,void 0,t,e,r,i));if(d===-1)return!1;l.splice(d,1)}return!0}case o2:case h2:case d2:case p2:case f2:case g2:case y2:case w2:case m2:case b2:case v2:case E2:{if(typeof Vs<"u"&&Vs.isBuffer(t)!==Vs.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Hr(t[c],e[c],c,t,e,r,i))return!1;return!0}case c2:return t.byteLength!==e.byteLength?!1:Jr(new Uint8Array(t),new Uint8Array(e),r,i);case u2:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Jr(new Uint8Array(t),new Uint8Array(e),r,i);case l2:return t.name===e.name&&t.message===e.message;case Ys:{if(!(Jr(t.constructor,e.constructor,r,i)||xc(t)&&xc(e)))return!1;const c=[...Object.keys(t),...Tc(t)],l=[...Object.keys(e),...Tc(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],d=t[h];if(!Object.hasOwn(e,h))return!1;const f=e[h];if(!Hr(d,f,h,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function D2(t,e){return I2(t,e,Z_)}var S2=Object.defineProperty,Nc=Object.getOwnPropertySymbols,O2=Object.prototype.hasOwnProperty,$2=Object.prototype.propertyIsEnumerable,xn=(t,e,r)=>e in t?S2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rc=(t,e)=>{for(var r in e||(e={}))O2.call(e,r)&&xn(t,r,e[r]);if(Nc)for(var r of Nc(e))$2.call(e,r)&&xn(t,r,e[r]);return t},Be=(t,e,r)=>xn(t,typeof e!="symbol"?e+"":e,r);class nr extends tp{constructor(e,r,i,s=ft,n=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,Be(this,"map",new Map),Be(this,"version",TE),Be(this,"cached",[]),Be(this,"initialized",!1),Be(this,"getKey"),Be(this,"storagePrefix",ft),Be(this,"recentlyDeleted",[]),Be(this,"recentlyDeletedLimit",200),Be(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Se(o)?this.map.set(this.getKey(o),o):Av(o)?this.map.set(o.id,o):Pv(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Be(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Be(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Be(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>D2(a[c],o[c]))):this.values)),Be(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Rc(Rc({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Be(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ce(r,this.name),this.storagePrefix=s,this.getKey=n}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=L("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var x2=Object.defineProperty,T2=(t,e,r)=>e in t?x2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,H=(t,e,r)=>T2(t,typeof e!="symbol"?e+"":e,r);class A2{constructor(e,r){this.core=e,this.logger=r,H(this,"name",RE),H(this,"version",CE),H(this,"events",new Gc),H(this,"pairings"),H(this,"initialized",!1),H(this,"storagePrefix",ft),H(this,"ignoredPayloadTypes",[It]),H(this,"registeredMethods",[]),H(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),H(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),H(this,"create",async i=>{this.isInitialized();const s=bn(),n=await this.core.crypto.setSymKey(s),o=pe(R.FIVE_MINUTES),a={protocol:ju},c={topic:n,expiry:o,relay:a,active:!1,methods:i==null?void 0:i.methods},l=tc({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i==null?void 0:i.methods});return this.events.emit(Ft.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i==null?void 0:i.transportType}),{topic:n,uri:l}}),H(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[ut.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=ec(i.uri);s.props.properties.topic=n,s.addTrace(ut.pairing_uri_validation_success),s.addTrace(ut.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),s.addTrace(ut.existing_pairing),u.active)throw s.setError(bt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(ut.pairing_not_expired)}const h=c||pe(R.FIVE_MINUTES),d={topic:n,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(n,h),await this.pairings.set(n,d),s.addTrace(ut.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Ft.create,d),s.addTrace(ut.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(ut.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(bt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw s.setError(bt.subscribe_pairing_topic_failure),f}return s.addTrace(ut.subscribe_pairing_topic_success),d}),H(this,"activate",async({topic:i})=>{this.isInitialized();const s=pe(R.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),H(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Mt();this.events.once(X("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),H(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),H(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),H(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),H(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",ne("USER_DISCONNECTED")),await this.deletePairing(s))}),H(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return tc({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),H(this,"sendRequest",async(i,s,n)=>{const o=Kt(s,n),a=await this.core.crypto.encode(i,o),c=qr[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),H(this,"sendResult",async(i,s,n)=>{const o=Bn(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=qr[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),H(this,"sendError",async(i,s,n)=>{const o=Ln(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=qr[c]?qr[c].res:qr.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),H(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ne("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),H(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>At(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),H(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),H(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),H(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(Ft.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),H(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{ht(s)?this.events.emit(X("pairing_ping",n),{}):Ze(s)&&this.events.emit(X("pairing_ping",n),{error:s.error})},500)}),H(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Ft.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),H(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=ne("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),H(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ne("WC_METHOD_UNSUPPORTED",i))}),H(this,"isValidPair",(i,s)=>{var n;if(!ke(i)){const{message:a}=L("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(bt.malformed_pairing_uri),new Error(a)}if(!Tv(i.uri)){const{message:a}=L("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(bt.malformed_pairing_uri),new Error(a)}const o=ec(i==null?void 0:i.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=L("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(bt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=L("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(bt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&R.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){s.setError(bt.pairing_expired);const{message:a}=L("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),H(this,"isValidPing",async i=>{if(!ke(i)){const{message:n}=L("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),H(this,"isValidDisconnect",async i=>{if(!ke(i)){const{message:n}=L("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),H(this,"isValidPairingTopic",async i=>{if(!he(i,!1)){const{message:s}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(At(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=L("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=Ce(r,this.name),this.pairings=new nr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return qe(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(me.message,async e=>{const{topic:r,message:i,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(r,i);so(n)?(this.core.history.set(r,n),await this.onRelayEventRequest({topic:r,payload:n})):hs(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id)),await this.core.relayer.messages.ack(r,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(Je.expired,async e=>{const{topic:r}=eu(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ft.expire,{topic:r}))})}}var P2=Object.defineProperty,N2=(t,e,r)=>e in t?P2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,De=(t,e,r)=>N2(t,typeof e!="symbol"?e+"":e,r);class R2 extends Zd{constructor(e,r){super(e,r),this.core=e,this.logger=r,De(this,"records",new Map),De(this,"events",new ot.EventEmitter),De(this,"name",LE),De(this,"version",BE),De(this,"cached",[]),De(this,"initialized",!1),De(this,"storagePrefix",ft),De(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),De(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:pe(R.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(et.created,o)}),De(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Ze(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(et.updated,s))}),De(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),De(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(et.deleted,n)}}),this.persist()}),De(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),De(this,"on",(i,s)=>{this.events.on(i,s)}),De(this,"once",(i,s)=>{this.events.once(i,s)}),De(this,"off",(i,s)=>{this.events.off(i,s)}),De(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Ce(r,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Kt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(et.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(et.created,e=>{const r=et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(et.updated,e=>{const r=et.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(et.deleted,e=>{const r=et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(rr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{R.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(et.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var C2=Object.defineProperty,L2=(t,e,r)=>e in t?C2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ae=(t,e,r)=>L2(t,typeof e!="symbol"?e+"":e,r);class B2 extends ip{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ae(this,"expirations",new Map),Ae(this,"events",new ot.EventEmitter),Ae(this,"name",UE),Ae(this,"version",kE),Ae(this,"cached",[]),Ae(this,"initialized",!1),Ae(this,"storagePrefix",ft),Ae(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ae(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Ae(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(Je.created,{target:n,expiration:o})}),Ae(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),Ae(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Je.deleted,{target:s,expiration:n})}}),Ae(this,"on",(i,s)=>{this.events.on(i,s)}),Ae(this,"once",(i,s)=>{this.events.once(i,s)}),Ae(this,"off",(i,s)=>{this.events.off(i,s)}),Ae(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Ce(r,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Pm(e);if(typeof e=="number")return Nm(e);const{message:r}=L("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Je.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=L("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=L("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;R.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Je.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(rr.pulse,()=>this.checkExpirations()),this.events.on(Je.created,e=>{const r=Je.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Je.expired,e=>{const r=Je.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Je.deleted,e=>{const r=Je.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}}var U2=Object.defineProperty,k2=(t,e,r)=>e in t?U2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ue=(t,e,r)=>k2(t,typeof e!="symbol"?e+"":e,r);class M2 extends sp{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,ue(this,"name",ME),ue(this,"abortController"),ue(this,"isDevEnv"),ue(this,"verifyUrlV3",qE),ue(this,"storagePrefix",ft),ue(this,"version",Mu),ue(this,"publicKey"),ue(this,"fetchPromise"),ue(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&R.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ue(this,"register",async s=>{if(!Ar()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=Jt(),u=this.startAbortTimer(R.ONE_SECOND*5),h=await new Promise((d,f)=>{const p=()=>{window.removeEventListener("message",y),l.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const y=m=>{if(m.data&&typeof m.data=="string")try{const w=JSON.parse(m.data);if(w.type==="verify_attestation"){if(nn(w.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",y),d(w.attestation===null?"":w.attestation)}}catch(w){this.logger.warn(w)}};l.body.appendChild(g),window.addEventListener("message",y,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),ue(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(nn(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(o,c)}),ue(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(R.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ue(this,"getVerifyUrl",s=>{let n=s||Yr;return zE.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Yr}`),n=Yr),n}),ue(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(R.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),ue(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),ue(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ue(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ue(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ue(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),ue(this,"validateAttestation",(s,n)=>{const o=av(s,n.publicKey),a={hasExpired:R.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ce(r,this.name),this.abortController=new AbortController,this.isDevEnv=Jn(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return qe(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),R.toMiliseconds(e))}}var j2=Object.defineProperty,q2=(t,e,r)=>e in t?j2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cc=(t,e,r)=>q2(t,typeof e!="symbol"?e+"":e,r);class z2 extends np{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Cc(this,"context",FE),Cc(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${KE}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=Ce(r,this.context)}}var F2=Object.defineProperty,Lc=Object.getOwnPropertySymbols,K2=Object.prototype.hasOwnProperty,V2=Object.prototype.propertyIsEnumerable,Tn=(t,e,r)=>e in t?F2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Kr=(t,e)=>{for(var r in e||(e={}))K2.call(e,r)&&Tn(t,r,e[r]);if(Lc)for(var r of Lc(e))V2.call(e,r)&&Tn(t,r,e[r]);return t},ge=(t,e,r)=>Tn(t,typeof e!="symbol"?e+"":e,r);class H2 extends op{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,ge(this,"context",HE),ge(this,"storagePrefix",ft),ge(this,"storageVersion",VE),ge(this,"events",new Map),ge(this,"shouldPersist",!1),ge(this,"init",async()=>{if(!Jn())try{const s={eventId:Da(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Xl(this.core.relayer.protocol,this.core.relayer.version,En)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),ge(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=Da(),u=this.core.projectId||"",h=Date.now(),d=Kr({eventId:l,timestamp:h,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),ge(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Kr(Kr({},a),this.setMethods(a.eventId))}),ge(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),ge(this,"setEventListeners",()=>{this.core.heartbeat.on(rr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{R.fromMiliseconds(Date.now())-R.fromMiliseconds(s.timestamp)>WE&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),ge(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),ge(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),ge(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),ge(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ge(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,Kr(Kr({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),ge(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),ge(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${GE}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${En}${n}`,{method:"POST",body:JSON.stringify(s)})}),ge(this,"getAppDomain",()=>Zl().url),this.logger=Ce(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var W2=Object.defineProperty,Bc=Object.getOwnPropertySymbols,G2=Object.prototype.hasOwnProperty,Y2=Object.prototype.propertyIsEnumerable,An=(t,e,r)=>e in t?W2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Uc=(t,e)=>{for(var r in e||(e={}))G2.call(e,r)&&An(t,r,e[r]);if(Bc)for(var r of Bc(e))Y2.call(e,r)&&An(t,r,e[r]);return t},se=(t,e,r)=>An(t,typeof e!="symbol"?e+"":e,r);class no extends Wd{constructor(e){var r;super(e),se(this,"protocol",ku),se(this,"version",Mu),se(this,"name",vn),se(this,"relayUrl"),se(this,"projectId"),se(this,"customStoragePrefix"),se(this,"events",new ot.EventEmitter),se(this,"logger"),se(this,"heartbeat"),se(this,"relayer"),se(this,"crypto"),se(this,"storage"),se(this,"history"),se(this,"expirer"),se(this,"pairing"),se(this,"verify"),se(this,"echoClient"),se(this,"linkModeSupportedApps"),se(this,"eventClient"),se(this,"initialized",!1),se(this,"logChunkController"),se(this,"on",(a,c)=>this.events.on(a,c)),se(this,"once",(a,c)=>this.events.once(a,c)),se(this,"off",(a,c)=>this.events.off(a,c)),se(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),se(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const i=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||qu,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=Mn({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:yE.logger,name:vn}),{logger:n,chunkLoggerController:o}=Kd({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ce(n,this.name),this.heartbeat=new Ch,this.crypto=new I_(this,this.logger,e==null?void 0:e.keychain),this.history=new R2(this,this.logger),this.expirer=new B2(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new yd(Uc(Uc({},wE),e==null?void 0:e.storageOptions)),this.relayer=new J_({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new A2(this,this.logger),this.verify=new M2(this,this.logger,this.storage),this.echoClient=new z2(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new H2(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new no(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(AE,i),r}get context(){return qe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(yc,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(yc)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&gE.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const J2=no,oo="wc",ao=2,co="client",ps=`${oo}@${ao}:${co}:`,ji={name:co,logger:"error"},Pn="WALLETCONNECT_DEEPLINK_CHOICE",Qu="proposal",Nn="Proposal expired",eh="session",jt=R.SEVEN_DAYS,th="engine",de={wc_sessionPropose:{req:{ttl:R.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:R.ONE_DAY,prompt:!1,tag:1104},res:{ttl:R.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:R.ONE_DAY,prompt:!1,tag:1106},res:{ttl:R.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:R.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:R.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:R.ONE_DAY,prompt:!1,tag:1112},res:{ttl:R.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:R.ONE_DAY,prompt:!1,tag:1114},res:{ttl:R.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:R.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:R.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:R.FIVE_MINUTES,prompt:!1,tag:1119}}},qi={min:R.FIVE_MINUTES,max:R.SEVEN_DAYS},st={idle:"IDLE",active:"ACTIVE"},Rn={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},rh="request",ih=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],sh="wc",nh="auth",oh="authKeys",ah="pairingTopics",ch="requests",bi=`${sh}@${1.5}:${nh}:`,Zr=`${bi}:PUB_KEY`;var Z2=Object.defineProperty,X2=Object.defineProperties,Q2=Object.getOwnPropertyDescriptors,kc=Object.getOwnPropertySymbols,eI=Object.prototype.hasOwnProperty,tI=Object.prototype.propertyIsEnumerable,Cn=(t,e,r)=>e in t?Z2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,re=(t,e)=>{for(var r in e||(e={}))eI.call(e,r)&&Cn(t,r,e[r]);if(kc)for(var r of kc(e))tI.call(e,r)&&Cn(t,r,e[r]);return t},Ne=(t,e)=>X2(t,Q2(e)),N=(t,e,r)=>Cn(t,typeof e!="symbol"?e+"":e,r);class rI extends up{constructor(e){super(e),N(this,"name",th),N(this,"events",new Gc),N(this,"initialized",!1),N(this,"requestQueue",{state:st.idle,queue:[]}),N(this,"sessionRequestQueue",{state:st.idle,queue:[]}),N(this,"requestQueueDelay",R.ONE_SECOND),N(this,"expectedPairingMethodMap",new Map),N(this,"recentlyDeletedMap",new Map),N(this,"recentlyDeletedLimit",200),N(this,"relayMessageCache",[]),N(this,"pendingSessions",new Map),N(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(de)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},R.toMiliseconds(this.requestQueueDelay)))}),N(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Ne(re({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=Dv(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=i;let u=s,h,d=!1;try{if(u){const $=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=$.active}}catch($){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),$}if(!u||!d){const{topic:$,uri:S}=await this.client.core.pairing.create();u=$,h=S}if(!u){const{message:$}=L("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error($)}const f=await this.client.core.crypto.generateKeyPair(),p=de.wc_sessionPropose.req.ttl||R.FIVE_MINUTES,g=pe(p),y=Ne(re(re({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:ju}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:St()}),m=X("session_connect",y.id),{reject:w,resolve:b,done:E}=Mt(p,Nn),O=({id:$})=>{$===y.id&&(this.client.events.off("proposal_expire",O),this.pendingSessions.delete(y.id),this.events.emit(m,{error:{message:Nn,code:0}}))};return this.client.events.on("proposal_expire",O),this.events.once(m,({error:$,session:S})=>{this.client.events.off("proposal_expire",O),$?w($):S&&b(S)}),await this.sendRequest({topic:u,method:"wc_sessionPropose",params:y,throwOnFailedPublish:!0,clientRpcId:y.id}),await this.setProposal(y.id,y),{uri:h,approval:E}}),N(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),N(this,"approve",async r=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r==null?void 0:r.id)==null?void 0:i.toString(),trace:[tt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(I){throw o.setError(Ut.no_internet_connection),I}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(I){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(Ut.proposal_not_found),I}try{await this.isValidApprove(r)}catch(I){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ut.session_approve_namespace_validation_failure),I}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=r,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:g,requiredNamespaces:y,optionalNamespaces:m}=f;let w=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:p});w||(w=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:tt.session_approve_started,properties:{topic:p,trace:[tt.session_approve_started,tt.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),E=g.publicKey,O=await this.client.core.crypto.generateSharedKey(b,E),$=re(re(re({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:b,metadata:this.client.metadata},expiry:pe(jt)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),S=ae.relay;w.addTrace(tt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(O,{transportType:S})}catch(I){throw w.setError(Ut.subscribe_session_topic_failure),I}w.addTrace(tt.subscribe_session_topic_success);const T=Ne(re({},$),{topic:O,requiredNamespaces:y,optionalNamespaces:m,pairingTopic:p,acknowledged:!1,self:$.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:b,transportType:ae.relay});await this.client.session.set(O,T),w.addTrace(tt.store_session);try{w.addTrace(tt.publishing_session_settle),await this.sendRequest({topic:O,method:"wc_sessionSettle",params:$,throwOnFailedPublish:!0}).catch(I=>{throw w==null||w.setError(Ut.session_settle_publish_failure),I}),w.addTrace(tt.session_settle_publish_success),w.addTrace(tt.publishing_session_approve),await this.sendResult({id:a,topic:p,result:{relay:{protocol:c??"irn"},responderPublicKey:b},throwOnFailedPublish:!0}).catch(I=>{throw w==null||w.setError(Ut.session_approve_publish_failure),I}),w.addTrace(tt.session_approve_publish_success)}catch(I){throw this.client.logger.error(I),this.client.session.delete(O,ne("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(O),I}return this.client.core.eventClient.deleteEvent({eventId:w.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.client.proposal.delete(a,ne("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(O,pe(jt)),{topic:O,acknowledged:()=>Promise.resolve(this.client.session.get(O))}}),N(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=r;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&(await this.sendError({id:i,topic:n,error:s,rpcOpts:de.wc_sessionPropose.reject}),await this.client.proposal.delete(i,ne("USER_DISCONNECTED")))}),N(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:s}=r,{done:n,resolve:o,reject:a}=Mt(),c=St(),l=Vt().toString(),u=this.client.session.get(i).namespaces;return this.events.once(X("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:u}),a(h)}),{acknowledged:n}}),N(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,s=St(),{done:n,resolve:o,reject:a}=Mt();return this.events.once(X("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,pe(jt)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),N(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:i,request:s,topic:n,expiry:o=de.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(n);(a==null?void 0:a.transportType)===ae.relay&&await this.confirmOnlineStateOrThrow();const c=St(),l=Vt().toString(),{done:u,resolve:h,reject:d}=Mt(o,"Request expired. Please try again.");this.events.once(X("session_request",c),({error:m,result:w})=>{m?d(m):h(w)});const f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:{request:Ne(re({},s),{expiryTimestamp:pe(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>d(m)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await u();const g={request:Ne(re({},s),{expiryTimestamp:pe(o)}),chainId:i},y=this.shouldSetTVF(f,g);return await Promise.all([new Promise(async m=>{await this.sendRequest(re({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:g,expiry:o,throwOnFailedPublish:!0},y&&{tvf:this.getTVFParams(c,g)})).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),m()}),new Promise(async m=>{var w;if(!((w=a.sessionConfig)!=null&&w.disableDeepLink)){const b=await Bm(this.client.core.storage,Pn);await Rm({id:c,topic:n,wcDeepLink:b})}m()}),u()]).then(m=>m[2])}),N(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:n}=s,o=this.client.session.get(i);o.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);ht(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:a}):Ze(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:a}),this.cleanupAfterResponse(r)}),N(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=St(),n=Vt().toString(),{done:o,resolve:a,reject:c}=Mt();this.events.once(X("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),N(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:s,chainId:n}=r,o=Vt().toString(),a=St();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),N(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:ne("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=L("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),N(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>$v(i,r)))),N(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),N(this,"authenticate",async(r,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:d,exp:f,nbf:p,methods:g=[],expiry:y}=r,m=[...r.resources||[]],{topic:w,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:w,uri:b}});const E=await this.client.core.crypto.generateKeyPair(),O=ki(E);if(await Promise.all([this.client.auth.authKeys.set(Zr,{responseTopic:O,publicKey:E}),this.client.auth.pairingTopics.set(O,{topic:O,pairingTopic:w})]),await this.client.core.relayer.subscribe(O,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${w}`),g.length>0){const{namespace:D}=Bi(a[0]);let C=xb(D,"request",g);Ui(m)&&(C=Ab(C,m.pop())),m.push(C)}const $=y&&y>de.wc_sessionAuthenticate.req.ttl?y:de.wc_sessionAuthenticate.req.ttl,S={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:f,nbf:p,resources:m},requester:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:pe($)},T={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},I={requiredNamespaces:{},optionalNamespaces:T,relays:[{protocol:"irn"}],pairingTopic:w,proposer:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:pe(de.wc_sessionPropose.req.ttl),id:St()},{done:j,resolve:B,reject:k}=Mt($,"Request expired"),q=St(),P=X("session_connect",I.id),_=X("session_request",q),v=async({error:D,session:C})=>{this.events.off(_,x),D?k(D):C&&B({session:C})},x=async D=>{var C,U,M;if(await this.deletePendingAuthRequest(q,{message:"fulfilled",code:0}),D.error){const Y=ne("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return D.error.code===Y.code?void 0:(this.events.off(P,v),k(D.error.message))}await this.deleteProposal(I.id),this.events.off(P,v);const{cacaos:z,responder:F}=D.result,V=[],G=[];for(const Y of z){await Na({cacao:Y,projectId:this.client.core.projectId})||(this.client.logger.error(Y,"Signature verification failed"),k(ne("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Te}=Y,Ee=Ui(Te.resources),Pe=[un(Te.iss)],We=Gi(Te.iss);if(Ee){const Ge=Ra(Ee),or=Ca(Ee);V.push(...Ge),Pe.push(...or)}for(const Ge of Pe)G.push(`${Ge}:${We}`)}const ie=await this.client.core.crypto.generateSharedKey(E,F.publicKey);let Q;V.length>0&&(Q={topic:ie,acknowledged:!0,self:{publicKey:E,metadata:this.client.metadata},peer:F,controller:F.publicKey,expiry:pe(jt),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:w,namespaces:nc([...new Set(V)],[...new Set(G)]),transportType:o},await this.client.core.relayer.subscribe(ie,{transportType:o}),await this.client.session.set(ie,Q),w&&await this.client.core.pairing.updateMetadata({topic:w,metadata:F.metadata}),Q=this.client.session.get(ie)),(C=this.client.metadata.redirect)!=null&&C.linkMode&&(U=F.metadata.redirect)!=null&&U.linkMode&&(M=F.metadata.redirect)!=null&&M.universal&&i&&(this.client.core.addLinkModeSupportedApp(F.metadata.redirect.universal),this.client.session.update(ie,{transportType:ae.link_mode})),B({auths:z,session:Q})};this.events.once(P,v),this.events.once(_,x);let A;try{if(n){const D=Kt("wc_sessionAuthenticate",S,q);this.client.core.history.set(w,D);const C=await this.client.core.crypto.encode("",D,{type:yi,encoding:Pt});A=Ai(i,w,C)}else await Promise.all([this.sendRequest({topic:w,method:"wc_sessionAuthenticate",params:S,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:q}),this.sendRequest({topic:w,method:"wc_sessionPropose",params:I,expiry:de.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:I.id})])}catch(D){throw this.events.off(P,v),this.events.off(_,x),D}return await this.setProposal(I.id,I),await this.setAuthRequest(q,{request:Ne(re({},S),{verifyContext:{}}),pairingTopic:w,transportType:o}),{uri:A??b,response:j}}),N(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:s}=r,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[kt.authenticated_session_approve_started]}});try{this.isInitialized()}catch(y){throw n.setError(zr.no_internet_connection),y}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(zr.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=ki(c),h={type:It,receiverPublicKey:c,senderPublicKey:l},d=[],f=[];for(const y of s){if(!await Na({cacao:y,projectId:this.client.core.projectId})){n.setError(zr.invalid_cacao);const O=ne("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:O,encodeOpts:h}),new Error(O.message)}n.addTrace(kt.cacaos_verified);const{p:m}=y,w=Ui(m.resources),b=[un(m.iss)],E=Gi(m.iss);if(w){const O=Ra(w),$=Ca(w);d.push(...O),b.push(...$)}for(const O of b)f.push(`${O}:${E}`)}const p=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(kt.create_authenticated_session_topic);let g;if((d==null?void 0:d.length)>0){g={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:pe(jt),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:nc([...new Set(d)],[...new Set(f)]),transportType:a},n.addTrace(kt.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(y){throw n.setError(zr.subscribe_authenticated_session_topic_failure),y}n.addTrace(kt.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),n.addTrace(kt.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(kt.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(y){throw n.setError(zr.authenticated_session_approve_publish_failure),y}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),N(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:s}=r,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=ki(o),l={type:It,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:l,rpcOpts:de.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,ne("USER_DISCONNECTED"))}),N(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:s}=r;return lu(i,s)}),N(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),N(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),N(this,"deleteSession",async r=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,ne("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Pn).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,ne("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=st.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),N(this,"deleteProposal",async(r,i)=>{if(i)try{const s=this.client.proposal.get(r),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(Ut.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ne("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),N(this,"deletePendingSessionRequest",async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==r),s&&(this.sessionRequestQueue.state=st.idle,this.client.events.emit("session_request_expire",{id:r}))}),N(this,"deletePendingAuthRequest",async(r,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])}),N(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),N(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,pe(de.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),N(this,"setAuthRequest",async(r,i)=>{const{request:s,pairingTopic:n,transportType:o=ae.relay}=i;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),N(this,"setPendingSessionRequest",async r=>{const{id:i,topic:s,params:n,verifyContext:o}=r,a=n.request.expiryTimestamp||pe(de.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),N(this,"sendRequest",async r=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h}=r,d=Kt(s,n,c);let f;const p=!!u;try{const m=p?Pt:nt;f=await this.client.core.crypto.encode(i,d,{encoding:m})}catch(m){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),m}let g;if(ih.includes(s)){const m=dt(JSON.stringify(d)),w=dt(f);g=await this.client.core.verify.register({id:w,decryptedId:m})}const y=de[s].req;if(y.attestation=g,o&&(y.ttl=o),a&&(y.id=a),this.client.core.history.set(i,d),p){const m=Ai(u,i,f);await globalThis.Linking.openURL(m,this.client.name)}else{const m=de[s].req;o&&(m.ttl=o),a&&(m.id=a),m.tvf=Ne(re({},h),{correlationId:d.id}),l?(m.internal=Ne(re({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,f,m)):this.client.core.relayer.publish(i,f,m).catch(w=>this.client.logger.error(w))}return d.id}),N(this,"sendResult",async r=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=Bn(i,n);let u;const h=c&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const p=h?Pt:nt;u=await this.client.core.crypto.encode(s,l,Ne(re({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let d,f;try{d=await this.client.core.history.get(s,i);const p=d.request;try{this.shouldSetTVF(p.method,p.params)&&(f=this.getTVFParams(i,p.params,n))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),p}if(h){const p=Ai(c,s,u);await globalThis.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=de[p].res;g.tvf=Ne(re({},f),{correlationId:i}),o?(g.internal=Ne(re({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,g)):this.client.core.relayer.publish(s,u,g).catch(y=>this.client.logger.error(y))}await this.client.core.history.resolve(l)}),N(this,"sendError",async r=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=Ln(i,n);let u;const h=c&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const f=h?Pt:nt;u=await this.client.core.crypto.encode(s,l,Ne(re({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),f}let d;try{d=await this.client.core.history.get(s,i)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),f}if(h){const f=Ai(c,s,u);await globalThis.Linking.openURL(f,this.client.name)}else{const f=d.request.method,p=a||de[f].res;this.client.core.relayer.publish(s,u,p)}await this.client.core.history.resolve(l)}),N(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;At(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{At(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),N(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),N(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),N(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===st.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=st.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=st.idle}),N(this,"processRequest",async r=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),N(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s,transportType:n}=r,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),N(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:s}=L("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),N(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:s}=r,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),N(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=r,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(bt.proposal_listener_not_found)),this.isValidConnect(re({},s.params));const u=a.expiryTimestamp||pe(de.wc_sessionPropose.req.ttl),h=re({id:c,pairingTopic:i,expiryTimestamp:u},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:n,hash:dt(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(ut.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:de.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),N(this,"onSessionProposeResponse",async(r,i,s)=>{const{id:n}=i;if(ht(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:r,proposalId:n,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(Ze(i)){await this.client.proposal.delete(n,ne("USER_DISCONNECTED"));const o=X("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),N(this,"onSessionSettleRequest",async(r,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=i.params,f=[...this.pendingSessions.values()].find(y=>y.sessionTopic===r);if(!f)return this.client.logger.error(`Pending session not found for topic ${r}`);const p=this.client.proposal.get(f.proposalId),g=Ne(re(re(re({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:ae.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(X("session_connect",f.proposalId),{session:g}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:r,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),N(this,"onSessionSettleResponse",async(r,i)=>{const{id:s}=i;ht(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(X("session_approve",s),{})):Ze(i)&&(await this.client.session.delete(r,ne("USER_DISCONNECTED")),this.events.emit(X("session_approve",s),{error:i.error}))}),N(this,"onSessionUpdateRequest",async(r,i)=>{const{params:s,id:n}=i;try{const o=`${r}_session_update`,a=jr.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:r,error:ne("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(re({topic:r},s));try{jr.set(o,n),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0})}catch(c){throw jr.delete(o),c}this.client.events.emit("session_update",{id:n,topic:r,params:s})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),N(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),N(this,"onSessionUpdateResponse",(r,i)=>{const{id:s}=i,n=X("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ht(i)?this.events.emit(X("session_update",s),{}):Ze(i)&&this.events.emit(X("session_update",s),{error:i.error})}),N(this,"onSessionExtendRequest",async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,pe(jt)),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),N(this,"onSessionExtendResponse",(r,i)=>{const{id:s}=i,n=X("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ht(i)?this.events.emit(X("session_extend",s),{}):Ze(i)&&this.events.emit(X("session_extend",s),{error:i.error})}),N(this,"onSessionPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),N(this,"onSessionPingResponse",(r,i)=>{const{id:s}=i,n=X("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);ht(i)?this.events.emit(X("session_ping",s),{}):Ze(i)&&this.events.emit(X("session_ping",s),{error:i.error})},500)}),N(this,"onSessionDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(me.publish,async()=>{n(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ne("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),N(this,"onSessionRequest",async r=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:d}=a;try{await this.isValidRequest(re({topic:o},d));const f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:dt(JSON.stringify(Kt("wc_sessionRequest",d,h))),encryptedId:l,metadata:f.peer.metadata,transportType:u}),g={id:h,topic:o,params:d,verifyContext:p};await this.setPendingSessionRequest(g),u===ae.link_mode&&(i=f.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=f.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:h,topic:o,error:f}),this.client.logger.error(f)}}),N(this,"onSessionRequestResponse",(r,i)=>{const{id:s}=i,n=X("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ht(i)?this.events.emit(X("session_request",s),{result:i.result}):Ze(i)&&this.events.emit(X("session_request",s),{error:i.error})}),N(this,"onSessionEventRequest",async(r,i)=>{const{id:s,params:n}=i;try{const o=`${r}_session_event_${n.event.name}`,a=jr.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(re({topic:r},n)),this.client.events.emit("session_event",{id:s,topic:r,params:n}),jr.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),N(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),ht(i)?this.events.emit(X("session_request",s),{result:i.result}):Ze(i)&&this.events.emit(X("session_request",s),{error:i.error})}),N(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=n.params,d=await this.getVerifyContext({attestationId:o,hash:dt(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:s,id:n.id,authPayload:u,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(n.id,{request:f,pairingTopic:s,transportType:c}),c===ae.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:d})}catch(l){this.client.logger.error(l);const u=n.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:It,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:n.id,topic:s,error:l,encodeOpts:f,rpcOpts:de.wc_sessionAuthenticate.autoReject,appLink:d})}}),N(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),N(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=st.idle,this.processSessionRequestQueue()},R.toMiliseconds(this.requestQueueDelay))}),N(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===r&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=X("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(X("session_request",n.request.id),{error:i})})}),N(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===st.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=st.active,this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),N(this,"emitSessionRequest",r=>{this.client.events.emit("session_request",r)}),N(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:Kt("wc_sessionPropose",Ne(re({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id)})}),N(this,"isValidConnect",async r=>{if(!ke(r)){const{message:l}=L("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Se(i)||await this.isValidPairingTopic(i),!Mv(c)){const{message:l}=L("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!Se(s)&&oi(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!Se(n)&&oi(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Se(o)||this.validateSessionProps(o,"sessionProperties"),!Se(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>l.includes(u)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),N(this,"validateNamespaces",(r,i)=>{const s=kv(r,"connect()",i);if(s)throw new Error(s.message)}),N(this,"isValidApprove",async r=>{if(!ke(r))throw new Error(L("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=Fs(s,"approve()");if(l)throw new Error(l.message);const u=cc(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!he(n,!0)){const{message:h}=L("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}if(Se(o)||this.validateSessionProps(o,"sessionProperties"),!Se(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(d=>h.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),N(this,"isValidReject",async r=>{if(!ke(r)){const{message:n}=L("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(n)}const{id:i,reason:s}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!qv(s)){const{message:n}=L("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),N(this,"isValidSessionSettleRequest",r=>{if(!ke(r)){const{message:l}=L("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:s,namespaces:n,expiry:o}=r;if(!Bu(i)){const{message:l}=L("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=Nv(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Fs(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(At(o)){const{message:l}=L("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),N(this,"isValidUpdate",async r=>{if(!ke(r)){const{message:c}=L("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:s}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=Fs(s,"update()");if(o)throw new Error(o.message);const a=cc(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),N(this,"isValidExtend",async r=>{if(!ke(r)){const{message:s}=L("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),N(this,"isValidRequest",async r=>{if(!ke(r)){const{message:c}=L("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!ac(a,n)){const{message:c}=L("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!zv(s)){const{message:c}=L("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!Vv(a,n,s.method)){const{message:c}=L("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!Yv(o,qi)){const{message:c}=L("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${qi.min} and ${qi.max}`);throw new Error(c)}}),N(this,"isValidRespond",async r=>{var i;if(!ke(r)){const{message:o}=L("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:s,response:n}=r;try{await this.isValidSessionTopic(s)}catch(o){throw(i=r==null?void 0:r.response)!=null&&i.id&&this.cleanupAfterResponse(r),o}if(!Fv(n)){const{message:o}=L("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),N(this,"isValidPing",async r=>{if(!ke(r)){const{message:s}=L("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),N(this,"isValidEmit",async r=>{if(!ke(r)){const{message:a}=L("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!ac(o,n)){const{message:a}=L("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!Kv(s)){const{message:a}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!Hv(o,n,s.name)){const{message:a}=L("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),N(this,"isValidDisconnect",async r=>{if(!ke(r)){const{message:s}=L("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),N(this,"isValidAuthenticate",r=>{const{chains:i,uri:s,domain:n,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!he(s,!1))throw new Error("uri is required parameter");if(!he(n,!1))throw new Error("domain is required parameter");if(!he(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Bi(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Bi(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),N(this,"getVerifyContext",async r=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Yr,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),N(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((s,n)=>{if(s==null){const{message:o}=L("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[n]}`);throw new Error(o)}})}),N(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),N(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),N(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:s}=L("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(s)}}),N(this,"isLinkModeEnabled",(r,i)=>{var s,n,o,a,c,l,u,h,d;return!r||i!==ae.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r==null?void 0:r.redirect)==null?void 0:u.universal)!==void 0&&((h=r==null?void 0:r.redirect)==null?void 0:h.universal)!==""&&((d=r==null?void 0:r.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"}),N(this,"getAppLinkIfEnabled",(r,i)=>{var s;return this.isLinkModeEnabled(r,i)?(s=r==null?void 0:r.redirect)==null?void 0:s.universal:void 0}),N(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=Ia(r,"topic")||"",s=decodeURIComponent(Ia(r,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),N(this,"registerLinkModeListeners",async()=>{var r;if(Jn()||Ct()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=globalThis==null?void 0:globalThis.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),N(this,"shouldSetTVF",(r,i)=>{if(!i||r!=="wc_sessionRequest")return!1;const{request:s}=i;return Object.keys(Rn).includes(s.method)}),N(this,"getTVFParams",(r,i,s)=>{var n,o;try{const a=i.request.method,c=this.extractTxHashesFromResult(a,s);return Ne(re({correlationId:r,rpcMethods:[a],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(o=(n=i.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),N(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const s=(r==null?void 0:r.data)||((i=r==null?void 0:r[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),N(this,"extractTxHashesFromResult",(r,i)=>{try{const s=Rn[r];if(typeof i=="string")return[i];const n=i[s.key];if(wi(n))return r==="solana_signAllTransactions"?n.map(o=>fb(o)):n;if(typeof n=="string")return[n]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(r))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=L("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(me.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Zr)?this.client.auth.authKeys.get(Zr):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:n===ae.link_mode?Pt:nt});so(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:n,encryptedId:dt(i)})):hs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:n}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Je.expired,async e=>{const{topic:r,id:i}=eu(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,L("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,L("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ft.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Ft.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!he(e,!1)){const{message:r}=L("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=L("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(At(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=L("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!he(e,!1)){const{message:r}=L("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=L("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(At(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=L("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=L("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(he(e,!1)){const{message:r}=L("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=L("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!jv(e)){const{message:r}=L("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=L("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(At(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=L("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class iI extends nr{constructor(e,r){super(e,r,Qu,ps),this.core=e,this.logger=r}}class sI extends nr{constructor(e,r){super(e,r,eh,ps),this.core=e,this.logger=r}}class nI extends nr{constructor(e,r){super(e,r,rh,ps,i=>i.id),this.core=e,this.logger=r}}class oI extends nr{constructor(e,r){super(e,r,oh,bi,()=>Zr),this.core=e,this.logger=r}}class aI extends nr{constructor(e,r){super(e,r,ah,bi),this.core=e,this.logger=r}}class cI extends nr{constructor(e,r){super(e,r,ch,bi,i=>i.id),this.core=e,this.logger=r}}var lI=Object.defineProperty,uI=(t,e,r)=>e in t?lI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Js=(t,e,r)=>uI(t,typeof e!="symbol"?e+"":e,r);class hI{constructor(e,r){this.core=e,this.logger=r,Js(this,"authKeys"),Js(this,"pairingTopics"),Js(this,"requests"),this.authKeys=new oI(this.core,this.logger),this.pairingTopics=new aI(this.core,this.logger),this.requests=new cI(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var dI=Object.defineProperty,pI=(t,e,r)=>e in t?dI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,W=(t,e,r)=>pI(t,typeof e!="symbol"?e+"":e,r);class fs extends lp{constructor(e){super(e),W(this,"protocol",oo),W(this,"version",ao),W(this,"name",ji.name),W(this,"metadata"),W(this,"core"),W(this,"logger"),W(this,"events",new ot.EventEmitter),W(this,"engine"),W(this,"session"),W(this,"proposal"),W(this,"pendingRequest"),W(this,"auth"),W(this,"signConfig"),W(this,"on",(i,s)=>this.events.on(i,s)),W(this,"once",(i,s)=>this.events.once(i,s)),W(this,"off",(i,s)=>this.events.off(i,s)),W(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),W(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),W(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),W(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),W(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),W(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||ji.name,this.metadata=$m(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:es(Mn({level:(e==null?void 0:e.logger)||ji.logger}));this.core=(e==null?void 0:e.core)||new J2(e),this.logger=Ce(r,this.name),this.session=new sI(this.core,this.logger),this.proposal=new iI(this.core,this.logger),this.pendingRequest=new nI(this.core,this.logger),this.engine=new rI(this),this.auth=new hI(this.core,this.logger)}static async init(e){const r=new fs(e);return await r.initialize(),r}get context(){return qe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},R.toMiliseconds(R.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const fI=fs,eD=Object.freeze(Object.defineProperty({__proto__:null,AUTH_CONTEXT:nh,AUTH_KEYS_CONTEXT:oh,AUTH_PAIRING_TOPIC_CONTEXT:ah,AUTH_PROTOCOL:sh,AUTH_PUBLIC_KEY_NAME:Zr,AUTH_REQUEST_CONTEXT:ch,AUTH_STORAGE_PREFIX:bi,ENGINE_CONTEXT:th,ENGINE_QUEUE_STATES:st,ENGINE_RPC_OPTS:de,METHODS_TO_VERIFY:ih,PROPOSAL_CONTEXT:Qu,PROPOSAL_EXPIRY_MESSAGE:Nn,REQUEST_CONTEXT:rh,SESSION_CONTEXT:eh,SESSION_EXPIRY:jt,SESSION_REQUEST_EXPIRY_BOUNDARIES:qi,SIGN_CLIENT_CONTEXT:co,SIGN_CLIENT_DEFAULT:ji,SIGN_CLIENT_PROTOCOL:oo,SIGN_CLIENT_STORAGE_PREFIX:ps,SIGN_CLIENT_VERSION:ao,SignClient:fI,TVF_METHODS:Rn,WALLETCONNECT_DEEPLINK_CHOICE:Pn,default:fs},Symbol.toStringTag,{value:"Module"}));export{Zy as H,ua as a,qy as b,HI as c,VI as d,ss as e,YI as f,GI as g,eD as i,WI as r,jl as t,Xy as w};
